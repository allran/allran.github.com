<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Lua设计模式 | 木头人</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="创建型模式1、简单工厂模式2、工厂方法模式3、原型模式4、建造者模式5、单例模式6、抽象工厂模式结构型模式1、装饰模式2、代理模式3、外观模式4、适配器模式5、组合模式6、桥接模式7、享元模式行为模式1、策略模式2、模板方法模式3、观察者模式4、状态模式5、迭代器模式6、备忘录模式7、命令模式8、职责链模式9、解释器模式10、中介者模式11、访问者模式转载自http://blog.csdn.net">
<meta property="og:type" content="article">
<meta property="og:title" content="Lua设计模式">
<meta property="og:url" content="http://allran.github.io/2014/01/26/2014-01-26-lua-design-patterns/index.html">
<meta property="og:site_name" content="木头人">
<meta property="og:description" content="创建型模式1、简单工厂模式2、工厂方法模式3、原型模式4、建造者模式5、单例模式6、抽象工厂模式结构型模式1、装饰模式2、代理模式3、外观模式4、适配器模式5、组合模式6、桥接模式7、享元模式行为模式1、策略模式2、模板方法模式3、观察者模式4、状态模式5、迭代器模式6、备忘录模式7、命令模式8、职责链模式9、解释器模式10、中介者模式11、访问者模式转载自http://blog.csdn.net">
<meta property="og:updated_time" content="2014-01-26T09:48:47.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lua设计模式">
<meta name="twitter:description" content="创建型模式1、简单工厂模式2、工厂方法模式3、原型模式4、建造者模式5、单例模式6、抽象工厂模式结构型模式1、装饰模式2、代理模式3、外观模式4、适配器模式5、组合模式6、桥接模式7、享元模式行为模式1、策略模式2、模板方法模式3、观察者模式4、状态模式5、迭代器模式6、备忘录模式7、命令模式8、职责链模式9、解释器模式10、中介者模式11、访问者模式转载自http://blog.csdn.net">
  
    <link rel="alternative" href="/atom.xml" title="木头人" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">木头人</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">记录学习点滴</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/About">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://allran.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2014-01-26-lua-design-patterns" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/01/26/2014-01-26-lua-design-patterns/" class="article-date">
  <time datetime="2014-01-26T09:29:29.000Z" itemprop="datePublished">2014-01-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Lua/">Lua</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Lua设计模式
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>创建型模式<br>1、简单工厂模式<br>2、工厂方法模式<br>3、原型模式<br>4、建造者模式<br>5、单例模式<br>6、抽象工厂模式<br>结构型模式<br>1、装饰模式<br>2、代理模式<br>3、外观模式<br>4、适配器模式<br>5、组合模式<br>6、桥接模式<br>7、享元模式<br>行为模式<br>1、策略模式<br>2、模板方法模式<br>3、观察者模式<br>4、状态模式<br>5、迭代器模式<br>6、备忘录模式<br>7、命令模式<br>8、职责链模式<br>9、解释器模式<br>10、中介者模式<br>11、访问者模式<br>转载自<a href="http://blog.csdn.net/yitouhan/article/details/16952803" target="_blank" rel="external">http://blog.csdn.net/yitouhan/article/details/16952803</a></p>
<h1 id="详细描述:">详细描述:</h1><a id="more"></a>
<h1 id="-_创建型模式"> - 创建型模式</h1><h3 id="1、简单工厂模式">1、简单工厂模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OperationFactory = &#123;&#125;  &#10;Operation = &#123;&#125;  &#10;  &#10;function Operation:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    o.NumberA = 0  &#10;    o.NumberB = 1  &#10;    return o  &#10;end  &#10;  &#10;OperationAdd = Operation:new()  &#10;OperationSub = Operation:new()  &#10;OperationMul = Operation:new()  &#10;OperationDiv = Operation:new()  &#10;  &#10;function OperationAdd:GetResult()  &#10;    if self.NumberA and self.NumberB then  &#10;        return self.NumberA + self.NumberB;  &#10;    else          &#10;        return &#34;error&#34;  &#10;    end  &#10;end  &#10;  &#10;function OperationSub:GetResult()  &#10;    if self.NumberA and self.NumberB then  &#10;        return self.NumberA - self.NumberB;  &#10;    else  &#10;        return &#34;error&#34;  &#10;    end  &#10;end  &#10;  &#10;function OperationMul:GetResult()  &#10;    if self.NumberA and self.NumberB then  &#10;        return self.NumberA * self.NumberB;  &#10;    else  &#10;        return &#34;error&#34;  &#10;    end  &#10;end  &#10;  &#10;function OperationDiv:GetResult()  &#10;    if self.NumberA and self.NumberB and self.NumberB~=0 then  &#10;        return self.NumberA / self.NumberB;  &#10;    else  &#10;        return &#34;error&#34;  &#10;    end  &#10;end  &#10;  &#10;  &#10;function OperationFactory : CreateOperation(oper)  &#10;    if oper == &#34;+&#34; then  &#10;        return OperationAdd:new()  &#10;    elseif oper == &#34;-&#34; then  &#10;        return OperationSub:new()  &#10;    elseif oper == &#34;*&#34; then  &#10;        return OperationMul:new()  &#10;    elseif oper == &#34;/&#34; then  &#10;        return OperationDiv:new()  &#10;    else  &#10;    end  &#10;end  &#10;  &#10;Oper1 = OperationFactory:CreateOperation(&#34;+&#34;)  &#10;Oper1.NumberA = 10  &#10;Oper1.NumberB = 5  &#10;print(Oper1:GetResult())  &#10;  &#10;Oper2 = OperationFactory:CreateOperation(&#34;-&#34;)  &#10;Oper2.NumberA = 10  &#10;Oper2.NumberB = 5  &#10;print(Oper2:GetResult())  &#10;  &#10;Oper3 = OperationFactory:CreateOperation(&#34;*&#34;)  &#10;Oper3.NumberA = 10  &#10;Oper3.NumberB = 5  &#10;print(Oper3:GetResult())  &#10;  &#10;Oper4 = OperationFactory:CreateOperation(&#34;/&#34;)  &#10;Oper4.NumberA = 10  &#10;Oper4.NumberB = 5  &#10;print(Oper4:GetResult())</span><br></pre></td></tr></table></figure>
<p>输出结果：<br>15<br>5<br>50<br>2  </p>
<h3 id="2、工厂方法模式">2、工厂方法模式</h3><p>简单工厂就是生产整个计算器，而工厂方法只生产计算器的一部分；<br>原有的简单工厂可以生’+’ ‘-‘ ‘*’ ‘/‘ ;但是如果添加新的部件’%’，厂房就<br>需要扩充、修改很可以会影响原来部件的正常生产，这就违背了<br>开放封闭原则；而工厂方法则不存在这个问题；我新开一个工厂专门<br>生产’%’就可以了.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Factory = &#123;&#125;  &#10;Operation = &#123;&#125;  &#10;function Factory:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;function Operation:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;  &#10;  &#10;OperationAdd = Operation:new()  &#10;  &#10;function OperationAdd:GetResult()  &#10;    if self.NumberA and self.NumberB then  &#10;        return self.NumberA + self.NumberB;  &#10;    else  &#10;        return &#34;error&#34;  &#10;    end  &#10;end  &#10;  &#10;  &#10;FactoryAdd = Factory:new()  &#10;  &#10;function FactoryAdd:CreateOperation()  &#10;    return OperationAdd:new()  &#10;end  &#10;  &#10;OperationSub = Operation:new()  &#10;  &#10;function OperationSub:GetResult()  &#10;    if self.NumberA and self.NumberB then  &#10;        return self.NumberA - self.NumberB;  &#10;    else  &#10;        return &#34;error&#34;  &#10;    end  &#10;end  &#10;  &#10;  &#10;FactorySub = Factory:new()  &#10;  &#10;function FactorySub:CreateOperation()  &#10;    return OperationSub:new()  &#10;end  &#10;  &#10;OperationMul = Operation:new()  &#10;  &#10;function OperationMul:GetResult()  &#10;    if self.NumberA and self.NumberB then  &#10;        return self.NumberA * self.NumberB;  &#10;    else  &#10;        return &#34;error&#34;  &#10;    end  &#10;end  &#10;  &#10;  &#10;FactoryMul = Factory:new()  &#10;  &#10;function FactoryMul:CreateOperation()  &#10;    return OperationMul:new()  &#10;end  &#10;  &#10;OperationDiv = Operation:new()  &#10;  &#10;function OperationDiv:GetResult()  &#10;    if self.NumberA and self.NumberB then  &#10;        return self.NumberA / self.NumberB;  &#10;    else  &#10;        return &#34;error&#34;  &#10;    end  &#10;end  &#10;  &#10;  &#10;FactoryDiv = Factory:new()  &#10;  &#10;function FactoryDiv:CreateOperation()  &#10;    return OperationDiv:new()  &#10;end  &#10;  &#10;  &#10;  &#10;operAddFactory = FactoryAdd:new()           --&#23450;&#20041;&#19968;&#20010;&#24037;&#21378;&#23545;&#35937;  &#10;  &#10;operAdd = operAddFactory:CreateOperation()  &#10;  &#10;operAdd.NumberA = 10  &#10;  &#10;operAdd.NumberB = 5  &#10;  &#10;print(&#34;Add:&#34;..operAdd:GetResult())  &#10;  &#10;operSubFactory = FactorySub:new()           --&#23450;&#20041;&#19968;&#20010;&#24037;&#21378;&#23545;&#35937;  &#10;  &#10;operSub = operSubFactory:CreateOperation()  &#10;  &#10;operSub.NumberA = 10  &#10;  &#10;operSub.NumberB = 5  &#10;  &#10;print(&#34;Sub:&#34;..operSub:GetResult())  &#10;  &#10;operMulFactory = FactoryMul:new()           --&#23450;&#20041;&#19968;&#20010;&#24037;&#21378;&#23545;&#35937;  &#10;  &#10;operMul = operMulFactory:CreateOperation()  &#10;  &#10;operMul.NumberA = 10  &#10;  &#10;operMul.NumberB = 5  &#10;  &#10;print(&#34;Mul:&#34;..operMul:GetResult())  &#10;  &#10;operDivFactory = FactoryDiv:new()           --&#23450;&#20041;&#19968;&#20010;&#24037;&#21378;&#23545;&#35937;  &#10;  &#10;operDiv = operDivFactory:CreateOperation()  &#10;  &#10;operDiv.NumberA = 10  &#10;  &#10;operDiv.NumberB = 5  &#10;  &#10;print(&#34;Div:&#34;..operDiv:GetResult())  &#10;  &#10;--[[    **************&#26032;&#28155;&#21152;&#30340;&#39;%&#39;&#25805;&#20316;***************  ]]--  &#10;  &#10;OperationMod = Operation:new()  &#10;  &#10;function OperationMod:GetResult()  &#10;    if self.NumberA and self.NumberB then  &#10;        return self.NumberA % self.NumberB;  &#10;    else  &#10;        return &#34;error&#34;  &#10;    end  &#10;end  &#10;  &#10;  &#10;FactoryMod = Factory:new()  &#10;  &#10;function FactoryMod:CreateOperation()  &#10;    return OperationMod:new()  &#10;end  &#10;  &#10;operModFactory = FactoryMod:new()           --&#23450;&#20041;&#19968;&#20010;&#24037;&#21378;&#23545;&#35937;  &#10;  &#10;operMod = operModFactory:CreateOperation()  &#10;  &#10;operMod.NumberA = 10  &#10;  &#10;operMod.NumberB = 5  &#10;  &#10;print(&#34;Mod:&#34;..operDiv:GetResult())</span><br></pre></td></tr></table></figure></p>
<p>输出结果：<br>Add:15<br>Sub:5<br>Mul:50<br>Div:2<br>Mod:2  </p>
<h3 id="3、原型模式">3、原型模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--&#21407;&#22411;&#27169;&#24335;&#21487;&#20998;&#20026;&#28145;&#22797;&#21046;&#21644;&#27973;&#22797;&#21046;&#65292;&#19979;&#38754;&#20197;&#28145;&#22797;&#21046;&#20026;&#20363;  &#10;  &#10;Prototype = &#123;&#125;  &#10;  &#10;function Prototype:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o  &#10;end  &#10;  &#10;function Prototype:Clone()  &#10;    return self  &#10;end  &#10;  &#10;proto = Prototype:new()  &#10;  &#10;proto.val = 10  &#10;  &#10;cloneproto = proto:Clone()  &#10;  &#10;print(&#34;&#36755;&#20986;:&#34;..cloneproto.val)</span><br></pre></td></tr></table></figure>
<p>输出:10</p>
<h3 id="4、建造者模式">4、建造者模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--[[  &#10;    &#23558;&#19968;&#20010;&#22797;&#26434;&#23545;&#35937;&#30340;&#26500;&#36896;&#19982;&#23427;&#30340;&#34920;&#31034;&#20998;&#31163;&#65292;&#20351;&#21516;&#26679;&#30340;&#26500;&#24314;&#36807;&#31243;&#21487;&#20197;&#21019;&#24314;&#19981;&#21516;&#30340;&#34920;&#31034;&#65292;&#36825;&#26679;&#30340;&#35774;&#35745;&#27169;&#24335;&#34987;&#31216;&#20026;&#24314;&#36896;&#32773;&#27169;&#24335;  &#10;  &#10;    1 &#24403;&#21019;&#24314;&#22797;&#26434;&#23545;&#35937;&#30340;&#31639;&#27861;&#24212;&#35813;&#29420;&#31435;&#20110;&#35813;&#23545;&#35937;&#30340;&#32452;&#25104;&#37096;&#20998;&#20197;&#21450;&#23427;&#20204;&#30340;&#35013;&#37197;&#26041;&#24335;&#26102;&#12290;  &#10;    2 &#24403;&#26500;&#36896;&#36807;&#31243;&#24517;&#39035;&#20801;&#35768;&#34987;&#26500;&#36896;&#30340;&#23545;&#35937;&#26377;&#19981;&#21516;&#34920;&#31034;&#26102;&#12290;  &#10;  &#10;]]--  &#10;  &#10;Director = &#123;&#125;  &#10;  &#10;function Director:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;function Director:Construct(builder)  &#10;    if builder ~= nil then  &#10;        builder:Coating()  &#10;        builder:Engine()  &#10;        builder:Radar()  &#10;    end  &#10;end  &#10;  &#10;Builder = &#123;&#125;  &#10;  &#10;function Builder:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;Product = &#123;&#125;  &#10;  &#10;function Product:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;function Product:Show()  &#10;    print(self.unit)  &#10;end  &#10;  &#10;F22Builder = Builder:new()  &#10;  &#10;function F22Builder:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    o.product = Product:new()  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;function F22Builder:Coating()  &#10;    if self.product.unit == nil then  &#10;        self.product.unit = &#34;F22&#20855;&#26377;:&#34;  &#10;    end  &#10;    self.product.unit = self.product.unit..&#34; &#38544;&#24418;&#28034;&#26009;&#34;  &#10;end  &#10;  &#10;function F22Builder:Engine()  &#10;    self.product.unit = self.product.unit..&#34; 2&#21488;F119-PW-100&#21457;&#21160;&#26426;&#34;  &#10;end  &#10;  &#10;function F22Builder:Radar()  &#10;    self.product.unit = self.product.unit..&#34; APG-77&#26377;&#28304;&#30456;&#25511;&#38453;&#38647;&#36798;&#34;  &#10;end  &#10;  &#10;function F22Builder:GetProduct()  &#10;    return self.product  &#10;end  &#10;  &#10;J10Builder = Builder:new()  &#10;  &#10;function J10Builder:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    o.product = Product:new()  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;function J10Builder:Coating()  &#10;    if self.product.unit == nil then  &#10;        self.product.unit = &#34;J10&#20855;&#26377;:&#34;  &#10;    end  &#10;    self.product.unit = self.product.unit..&#34; &#19968;&#33324;&#28034;&#26009;&#34;  &#10;end  &#10;  &#10;function J10Builder:Engine()  &#10;    self.product.unit = self.product.unit..&#34; 1&#21488;AL-31F&#21457;&#21160;&#26426;&#34;  &#10;end  &#10;  &#10;function J10Builder:Radar()  &#10;    self.product.unit = self.product.unit..&#34; JL-10&#33033;&#20914;&#22810;&#26222;&#21202;&#38647;&#36798;&#34;  &#10;end  &#10;  &#10;function J10Builder:GetProduct()  &#10;    return self.product  &#10;end  &#10;  &#10;  &#10;  &#10;--************* &#24314;&#36896;F22 **************  &#10;theF22Builder = F22Builder:new()  &#10;Director:Construct(theF22Builder)  &#10;F22 = theF22Builder:GetProduct()  &#10;F22:Show()  &#10;  &#10;--************* &#24314;&#36896;J10 **************  &#10;theJ10Builder = J10Builder:new()  &#10;Director:Construct(theJ10Builder)  &#10;J10 = theJ10Builder:GetProduct()  &#10;J10:Show()</span><br></pre></td></tr></table></figure>
<p>输出结果：<br>F22具有: 隐形涂料 2台F119-PW-100发动机 APG-77有源相控阵雷达<br>J10具有: 一般涂料 1台AL-31F发动机 JL-10脉冲多普勒雷达  </p>
<h3 id="5、单例模式">5、单例模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--[[  &#10;    &#20248;&#28857;  &#10;    &#19968;&#12289;&#23454;&#20363;&#25511;&#21046;  &#10;    &#21333;&#20363;&#27169;&#24335;&#20250;&#38459;&#27490;&#20854;&#20182;&#23545;&#35937;&#23454;&#20363;&#21270;&#20854;&#33258;&#24049;&#30340;&#21333;&#20363;&#23545;&#35937;&#30340;&#21103;&#26412;&#65292;&#20174;&#32780;&#30830;&#20445;&#25152;&#26377;&#23545;&#35937;&#37117;&#35775;&#38382;&#21807;&#19968;&#23454;&#20363;&#12290;  &#10;    &#20108;&#12289;&#28789;&#27963;&#24615;  &#10;    &#22240;&#20026;&#31867;&#25511;&#21046;&#20102;&#23454;&#20363;&#21270;&#36807;&#31243;&#65292;&#25152;&#20197;&#31867;&#21487;&#20197;&#28789;&#27963;&#26356;&#25913;&#23454;&#20363;&#21270;&#36807;&#31243;&#12290;  &#10;  &#10;    &#32570;&#28857;  &#10;    &#19968;&#12289;&#24320;&#38144;  &#10;    &#34429;&#28982;&#25968;&#37327;&#24456;&#23569;&#65292;&#20294;&#22914;&#26524;&#27599;&#27425;&#23545;&#35937;&#35831;&#27714;&#24341;&#29992;&#26102;&#37117;&#35201;&#26816;&#26597;&#26159;&#21542;&#23384;&#22312;&#31867;&#30340;&#23454;&#20363;&#65292;&#23558;&#20173;&#28982;&#38656;&#35201;&#19968;&#20123;&#24320;&#38144;&#12290;&#21487;&#20197;&#36890;&#36807;&#20351;&#29992;&#38745;&#24577;&#21021;&#22987;&#21270;&#35299;&#20915;&#27492;&#38382;&#39064;&#12290;  &#10;    &#20108;&#12289;&#21487;&#33021;&#30340;&#24320;&#21457;&#28151;&#28102;  &#10;    &#20351;&#29992;&#21333;&#20363;&#23545;&#35937;&#65288;&#23588;&#20854;&#22312;&#31867;&#24211;&#20013;&#23450;&#20041;&#30340;&#23545;&#35937;&#65289;&#26102;&#65292;&#24320;&#21457;&#20154;&#21592;&#24517;&#39035;&#35760;&#20303;&#33258;&#24049;&#19981;&#33021;&#20351;&#29992;new&#20851;&#38190;&#23383;&#23454;&#20363;&#21270;&#23545;&#35937;&#12290;&#22240;&#20026;&#21487;&#33021;&#26080;&#27861;&#35775;&#38382;&#24211;&#28304;&#20195;&#30721;&#65292;&#22240;&#27492;&#24212;&#29992;&#31243;&#24207;&#24320;&#21457;&#20154;&#21592;&#21487;&#33021;&#20250;&#24847;&#22806;&#21457;&#29616;&#33258;&#24049;&#26080;&#27861;&#30452;&#25509;&#23454;&#20363;&#21270;&#27492;&#31867;&#12290;  &#10;    &#19977;&#12289;&#23545;&#35937;&#29983;&#23384;&#26399;  &#10;    &#19981;&#33021;&#35299;&#20915;&#21024;&#38500;&#21333;&#20010;&#23545;&#35937;&#30340;&#38382;&#39064;&#12290;&#22312;&#25552;&#20379;&#20869;&#23384;&#31649;&#29702;&#30340;&#35821;&#35328;&#20013;&#65288;&#20363;&#22914;&#22522;&#20110;.NET Framework&#30340;&#35821;&#35328;&#65289;&#65292;&#21482;&#26377;&#21333;&#20363;&#31867;&#33021;&#22815;&#23548;&#33268;&#23454;&#20363;&#34987;&#21462;&#28040;&#20998;&#37197;&#65292;&#22240;&#20026;&#23427;&#21253;&#21547;&#23545;&#35813;&#23454;&#20363;&#30340;&#31169;&#26377;&#24341;&#29992;&#12290;&#22312;&#26576;&#20123;&#35821;&#35328;&#20013;&#65288;&#22914; C++&#65289;&#65292;&#20854;&#20182;&#31867;&#21487;&#20197;&#21024;&#38500;&#23545;&#35937;&#23454;&#20363;&#65292;&#20294;&#36825;&#26679;&#20250;&#23548;&#33268;&#21333;&#20363;&#31867;&#20013;&#20986;&#29616;&#24748;&#28014;&#24341;&#29992;&#12290;  &#10;  &#10;]]--  &#10;  &#10;Singleton = &#123;&#125;  &#10;function Singleton:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o  &#10;end  &#10;  &#10;function Singleton:Instance()  &#10;    if self.instance == nil then  &#10;        self.instance = self:new()  &#10;    end  &#10;    return self.instance  &#10;end  &#10;  &#10;  &#10;s1 = Singleton:Instance()  &#10;  &#10;s2 = Singleton:Instance()  &#10;  &#10;if s1 == s2 then  &#10;    print(&#34;&#20004;&#20010;&#23545;&#35937;&#26159;&#30456;&#21516;&#30340;&#23454;&#20363;&#34;)  &#10;end</span><br></pre></td></tr></table></figure>
<p>输出结果：<br>两个对象是相同的实例  </p>
<h3 id="6、抽象工厂模式">6、抽象工厂模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--[[  &#10;    &#24037;&#21378;&#26041;&#27861;&#27169;&#24335;&#65306;  &#10;            &#19968;&#20010;&#25277;&#35937;&#20135;&#21697;&#31867;&#65292;&#21487;&#20197;&#27966;&#29983;&#20986;&#22810;&#20010;&#20855;&#20307;&#20135;&#21697;&#31867;&#12290;  &#10;            &#19968;&#20010;&#25277;&#35937;&#24037;&#21378;&#31867;&#65292;&#21487;&#20197;&#27966;&#29983;&#20986;&#22810;&#20010;&#20855;&#20307;&#24037;&#21378;&#31867;&#12290;  &#10;            &#27599;&#20010;&#20855;&#20307;&#24037;&#21378;&#31867;&#21482;&#33021;&#21019;&#24314;&#19968;&#20010;&#20855;&#20307;&#20135;&#21697;&#31867;&#30340;&#23454;&#20363;&#12290;  &#10;    &#25277;&#35937;&#24037;&#21378;&#27169;&#24335;&#65306;  &#10;            &#22810;&#20010;&#25277;&#35937;&#20135;&#21697;&#31867;&#65292;&#27599;&#20010;&#25277;&#35937;&#20135;&#21697;&#31867;&#21487;&#20197;&#27966;&#29983;&#20986;&#22810;&#20010;&#20855;&#20307;&#20135;&#21697;&#31867;&#12290;  &#10;            &#19968;&#20010;&#25277;&#35937;&#24037;&#21378;&#31867;&#65292;&#21487;&#20197;&#27966;&#29983;&#20986;&#22810;&#20010;&#20855;&#20307;&#24037;&#21378;&#31867;&#12290;  &#10;            &#27599;&#20010;&#20855;&#20307;&#24037;&#21378;&#31867;&#21487;&#20197;&#21019;&#24314;&#22810;&#20010;&#20855;&#20307;&#20135;&#21697;&#31867;&#30340;&#23454;&#20363;&#12290;  &#10;]]--  &#10;  &#10;--[[  &#10;    &#25105;&#30340;&#24635;&#32467;&#65306;  &#10;    &#31616;&#21333;&#24037;&#21378;&#65306;&#19968;&#20010;&#24037;&#21378;&#29983;&#20135;&#25152;&#26377;&#30340;&#37096;&#20214;  &#10;    &#24037;&#21378;&#26041;&#27861;&#65306;&#19968;&#20010;&#24037;&#21378;&#29983;&#20135;&#19968;&#31181;&#37096;&#20214;  &#10;    &#25277;&#35937;&#24037;&#21378;&#65306;&#19968;&#20010;&#24037;&#21378;&#29983;&#20135;&#20960;&#31181;&#20135;&#21697;  &#10;]]--  &#10;  &#10;IUser = &#123;&#125;  &#10;  &#10;function IUser:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;SqlServerUser = IUser:new()  &#10;  &#10;function SqlServerUser:Insert()  &#10;    print(&#34;&#22312;SQL Server&#20013;&#32473;User&#34920;&#22686;&#21152;&#19968;&#26465;&#35760;&#24405;&#34;)  &#10;end  &#10;  &#10;function SqlServerUser:GetUserRecord()  &#10;    print(&#34;&#22312;SQL Server&#20013;User&#34920;&#33719;&#21462;&#19968;&#26465;&#35760;&#24405;&#34;)  &#10;end  &#10;  &#10;AccessUser = IUser:new()  &#10;  &#10;function AccessUser:Insert()  &#10;    print(&#34;&#22312;Access&#20013;&#32473;User&#34920;&#22686;&#21152;&#19968;&#26465;&#35760;&#24405;&#34;)  &#10;end  &#10;  &#10;function AccessUser:GetUserRecord()  &#10;    print(&#34;&#22312;Access&#20013;User&#34920;&#33719;&#21462;&#19968;&#26465;&#35760;&#24405;&#34;)  &#10;end  &#10;  &#10;IDepartment = &#123;&#125;  &#10;  &#10;function IDepartment:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;SqlServerDepartment = IDepartment:new()  &#10;  &#10;function SqlServerDepartment:Insert()  &#10;    print(&#34;&#22312;SQL Server&#20013;&#32473;Department&#34920;&#22686;&#21152;&#19968;&#26465;&#35760;&#24405;&#34;)  &#10;end  &#10;  &#10;function SqlServerDepartment:GetDepartmentRecord()  &#10;    print(&#34;&#22312;SQL Server&#20013;&#30340;Department&#34920;&#33719;&#21462;&#19968;&#26465;&#35760;&#24405;&#34;)  &#10;end  &#10;  &#10;AccessDepartment = IDepartment:new()  &#10;  &#10;function AccessDepartment:Insert()  &#10;    print(&#34;&#22312;Access&#20013;&#32473;Department&#34920;&#22686;&#21152;&#19968;&#26465;&#35760;&#24405;&#34;)  &#10;end  &#10;  &#10;function AccessDepartment:GetDepartmentRecord()  &#10;    print(&#34;&#22312;Access&#20013;&#30340;Department&#34920;&#33719;&#21462;&#19968;&#26465;&#35760;&#24405;&#34;)  &#10;end  &#10;  &#10;IFactory = &#123;&#125;  &#10;  &#10;function IFactory:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;SqlServerFactory = IFactory:new()  &#10;  &#10;function SqlServerFactory:GetUser()  &#10;    return SqlServerUser:new()  &#10;end  &#10;  &#10;function SqlServerFactory:GetDepartment()  &#10;    return SqlServerDepartment:new()  &#10;end  &#10;  &#10;AccessFactory = IFactory:new()  &#10;  &#10;function AccessFactory:GetUser()  &#10;    return AccessUser:new()  &#10;end  &#10;  &#10;function AccessFactory:GetDepartment()  &#10;    return AccessDepartment:new()  &#10;end  &#10;  &#10;choice = io.read()  &#10;factory = nil  &#10;if choice == &#34;Sqlserver&#34; then  &#10;    factory = SqlServerFactory:new()  &#10;elseif choice == &#34;Access&#34; then  &#10;    factory = AccessFactory:new()  &#10;end  &#10;  &#10;if factory ~= nil then  &#10;    user = factory:GetUser()  &#10;    department = factory:GetDepartment()  &#10;  &#10;    user:Insert()  &#10;    user:GetUserRecord()  &#10;  &#10;    department:Insert()  &#10;    department:GetDepartmentRecord()  &#10;end</span><br></pre></td></tr></table></figure>
<p>输入：<br>Sqlserver<br>输出：<br>在SQL Server中给User表增加一条记录<br>在SQL Server中User表获取一条记录<br>在SQL Server中给Department表增加一条记录<br>在SQL Server中的Department表获取一条记录  </p>
<h1 id="-_结构型模式"> - 结构型模式</h1><h3 id="1、装饰模式">1、装饰模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person = &#123;&#125;  &#10;  &#10;Decorator = &#123;&#125;  &#10;  &#10;function Person:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;function Person:Show()  &#10;    print(&#34;&#25105;&#26159;&#20154;&#34;)  &#10;end  &#10;  &#10;Decorator = Person:new&#123;component = nil&#125;  &#10;  &#10;function Decorator:Decorate(com)  &#10;    self.component = com  &#10;end  &#10;  &#10;function Decorator:Show()  &#10;    print(&#34;&#25105;&#26159;&#35013;&#39280;&#32773;&#34;)  &#10;end  &#10;  &#10;Shirt = Decorator:new()  &#10;  &#10;  &#10;function Shirt:Show()  &#10;    print(&#34;&#26368;&#21518;&#34924;&#34923;&#34;)  &#10;    if self.component ~= nil then  &#10;        self.component:Show()  &#10;    end  &#10;end  &#10;  &#10;  &#10;  &#10;Trouser = Decorator:new()  &#10;  &#10;function Trouser:Show()  &#10;    print(&#34;&#28982;&#21518;&#35044;&#23376;&#34;)  &#10;    if self.component ~= nil then  &#10;        self.component:Show()  &#10;    end  &#10;end  &#10;  &#10;Shoe = Decorator:new()  &#10;  &#10;function Shoe:Show()  &#10;    print(&#34;&#20808;&#31359;&#38795;&#23376;&#34;)  &#10;    if self.component ~= nil then  &#10;        self.component:Show()  &#10;    end  &#10;end  &#10;  &#10;person = Person:new()  &#10;  &#10;shirt = Shirt:new()  &#10;shirt:Decorate(person)  &#10;  &#10;trouser = Trouser:new()  &#10;trouser:Decorate(shirt)  &#10;  &#10;shoe = Shoe:new()  &#10;shoe:Decorate(trouser)  &#10;shoe:Show()</span><br></pre></td></tr></table></figure>
<p>代码输出：<br>先穿鞋子<br>然后裤子<br>最后衬衫<br>我是人  </p>
<h3 id="2、代理模式">2、代理模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--[[  &#10;    &#32972;&#26223;&#65306;&#38472;&#20896;&#31232;&#24819;&#36861;&#27714;&#24352;&#20271;&#33437;&#65292;&#20294;&#26159;&#26080;&#20174;&#19979;&#25163;&#65292;&#20110;&#26159;&#25214;&#26469;&#20102;&#35874;&#38662;&#30127;&#12290;  &#10;    &#38472;&#20896;&#31232;&#21483;&#35874;&#38662;&#30127;&#24110;&#22905;&#36865;&#27915;&#23043;&#23043;&#12289;&#29611;&#29808;&#33457;&#21644;&#24039;&#20811;&#21147;&#12290;&#20110;&#26159;&#35874;&#38662;&#30127;&#23601;  &#10;    &#26159;&#20195;&#29702;&#20154;&#12290;  &#10;]]--  &#10;  &#10;  &#10;GiveGift = &#123;girlname = nil&#125;  &#10;  &#10;function GiveGift:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;Pursuit = GiveGift:new()  &#10;  &#10;function Pursuit:new(o,name)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    o.girlname = name  &#10;    return o;  &#10;end  &#10;  &#10;function Pursuit:GiveDolls()  &#10;    if self.girlname ~= nil then  &#10;        print(&#34;&#36865;&#34;..self.girlname..&#34;&#27915;&#23043;&#23043;&#34;)  &#10;    end  &#10;end  &#10;  &#10;function Pursuit:GiveFlowers()  &#10;    if self.girlname ~= nil then  &#10;        print(&#34;&#36865;&#34;..self.girlname..&#34;&#29611;&#29808;&#33457;&#34;)  &#10;    end  &#10;end  &#10;  &#10;function Pursuit:GiveChocolate()  &#10;    if self.girlname ~= nil then  &#10;        print(&#34;&#36865;&#34;..self.girlname..&#34;&#24039;&#20811;&#21147;&#34;)  &#10;    end  &#10;end  &#10;  &#10;Proxy = GiveGift:new()  &#10;  &#10;function Proxy:new(o,name)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    o.pursuit = Pursuit:new(&#123;&#125;,name)  &#10;    return o;  &#10;end  &#10;  &#10;function Proxy:GiveDolls()  &#10;    self.pursuit:GiveDolls()  &#10;end  &#10;  &#10;function Proxy:GiveFlowers()  &#10;    self.pursuit:GiveFlowers()  &#10;end  &#10;  &#10;function Proxy:GiveChocolate()  &#10;    self.pursuit:GiveChocolate()  &#10;end  &#10;  &#10;XieTingFeng = Proxy:new(&#123;&#125;,&#34;&#24352;&#20271;&#33437;&#34;)  &#10;XieTingFeng:GiveDolls()  &#10;XieTingFeng:GiveFlowers()  &#10;XieTingFeng:GiveChocolate()</span><br></pre></td></tr></table></figure>
<p>输出结果：<br>送张伯芝洋娃娃<br>送张伯芝玫瑰花<br>送张伯芝巧克力  </p>
<h3 id="3、外观模式">3、外观模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--[[  &#10;&#20248;&#28857;&#65306; &#22806;&#35266;&#27169;&#24335;&#30340;&#30446;&#30340;&#19981;&#26159;&#32473;&#23376;&#31995;&#32479;&#28155;&#21152;&#26032;&#30340;&#21151;&#33021;&#25509;&#21475;&#65292;  &#10;    &#32780;&#26159;&#20026;&#20102;&#35753;&#22806;&#37096;&#20943;&#23569;&#19982;&#23376;&#31995;&#32479;&#20869;&#22810;&#20010;&#27169;&#22359;&#30340;&#20132;&#20114;&#65292;  &#10;    &#26494;&#25955;&#32806;&#21512;&#65292;&#20174;&#32780;&#35753;&#22806;&#37096;&#33021;&#22815;&#26356;&#31616;&#21333;&#30340;&#20351;&#29992;&#23376;&#31995;&#32479;&#12290;  &#10;    &#24403;&#28982;&#65292;&#36825;&#26159;&#19968;&#25226;&#21452;&#20995;&#21073;&#12290;  &#10;&#32570;&#28857;&#65306; &#19981;&#33021;&#24456;&#22909;&#22320;&#38480;&#21046;&#23458;&#25143;&#31471;&#30452;&#25509;&#20351;&#29992;&#23376;&#31995;&#32479;&#31867;&#65292;  &#10;    &#22914;&#26524;&#23545;&#23458;&#25143;&#31471;&#35775;&#38382;&#23376;&#31995;&#32479;&#31867;&#20570;&#22826;&#22810;&#30340;&#38480;&#21046;&#21017;&#20943;&#23569;&#20102;  &#10;    &#21487;&#21464;&#24615;&#21644;&#28789;&#27963;&#24615;&#12290;  &#10;    &#19979;&#38754;&#22806;&#37096;&#21482;&#19982;Facade&#20132;&#20114;&#65292;&#32780;Facade&#19982;System&#20132;&#20114;&#65292;  &#10;    &#20174;&#32780;&#36798;&#21040;&#19978;&#36848;&#30340;&#20248;&#28857;&#12290;  &#10;]]--  &#10;  &#10;System = &#123;&#125;  &#10;  &#10;function System:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    return o;  &#10;end  &#10;  &#10;SubSystemOne = System:new()  &#10;  &#10;function SubSystemOne:MethodOne()  &#10;    print(&#34;&#35843;&#29992;&#23376;&#31995;&#32479;&#19968;&#30340;&#26041;&#27861;&#19968;&#34;)  &#10;end  &#10;  &#10;function SubSystemOne:MethodTwo()  &#10;    print(&#34;&#35843;&#29992;&#23376;&#31995;&#32479;&#19968;&#30340;&#26041;&#27861;&#20108;&#34;)  &#10;end  &#10;  &#10;function SubSystemOne:MethodThree()  &#10;    print(&#34;&#35843;&#29992;&#23376;&#31995;&#32479;&#19968;&#30340;&#26041;&#27861;&#19977;&#34;)  &#10;end  &#10;  &#10;SubSystemTwo = System:new()  &#10;  &#10;function SubSystemTwo:MethodOne()  &#10;    print(&#34;&#35843;&#29992;&#23376;&#31995;&#32479;&#20108;&#30340;&#26041;&#27861;&#19968;&#34;)  &#10;end  &#10;  &#10;function SubSystemTwo:MethodTwo()  &#10;    print(&#34;&#35843;&#29992;&#23376;&#31995;&#32479;&#20108;&#30340;&#26041;&#27861;&#20108;&#34;)  &#10;end  &#10;  &#10;SubSystemThree = System:new()  &#10;  &#10;function SubSystemThree:MethodOne()  &#10;    print(&#34;&#35843;&#29992;&#23376;&#31995;&#32479;&#19977;&#30340;&#26041;&#27861;&#19968;&#34;)  &#10;end  &#10;  &#10;Facade = &#123;&#125;  &#10;function Facade:new(o)  &#10;    o = o or &#123;&#125;  &#10;    setmetatable(o,self)  &#10;    self.__index = self  &#10;    o.one = SubSystemOne:new()  &#10;    o.two = SubSystemTwo:new()  &#10;    o.three = SubSystemThree:new()  &#10;    return o;  &#10;end  &#10;  &#10;function Facade:MethodOne()  &#10;    self.one:MethodOne()  &#10;    self.one:MethodThree()  &#10;    self.two:MethodTwo()  &#10;end  &#10;  &#10;function Facade:MethodTwo()  &#10;    self.one:MethodTwo()  &#10;    self.two:MethodOne()  &#10;    self.three:MethodOne()  &#10;end  &#10;  &#10;function Facade:MethodThree()  &#10;    self.one:MethodOne()  &#10;    self.two:MethodOne()  &#10;    self.three:MethodOne()  &#10;end  &#10;  &#10;facade = Facade:new()  &#10;facade:MethodOne()  &#10;``` &#10;&#36755;&#20986;&#32467;&#26524;&#65306;  &#10;&#35843;&#29992;&#23376;&#31995;&#32479;&#19968;&#30340;&#26041;&#27861;&#19968;  &#10;&#35843;&#29992;&#23376;&#31995;&#32479;&#19968;&#30340;&#26041;&#27861;&#19977;  &#10;&#35843;&#29992;&#23376;&#31995;&#32479;&#20108;&#30340;&#26041;&#27861;&#20108;  &#10;&#10;&#10;&#10;&#10;###4&#12289;&#36866;&#37197;&#22120;&#27169;&#24335;</span><br></pre></td></tr></table></figure>
<p>—[[<br>        将一个类的接口转换成客户希望的另外一个接口。Adapter模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。<br>                                                                                                                ——Gang of Four  </p>
<pre><code>应用：  
例如联合国开会，每个国家的领导说着自己国家的语言，但接收着却有不同国家的人，因此国家领导人需要翻译，这个翻译就是适配器。  
例如我们玩游戏，特别玩以前不同平台的游戏，我们需要一个模拟器，这个模拟器就是适配器。  
</code></pre><p>]]—  </p>
<p>—以下假设两人开会，奥爸妈 习近萍  </p>
<p>Target = {}  </p>
<p>function Target:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o;<br>end  </p>
<p>function Target:Listen(content)<br>    print(content)<br>end  </p>
<p>Adaptee = {}  </p>
<p>function Adaptee:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o;<br>end  </p>
<p>function Adaptee:Translate(content)<br>    —在这里做适配操作<br>    return “Are you happy?”<br>end  </p>
<p>Adapter = Target:new()  </p>
<p>function Adapter:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.adaptee = Adaptee:new()<br>    return o;<br>end  </p>
<p>function Adapter:Listen(content)<br>    print(self.adaptee:Translate(content))<br>end  </p>
<p>—习近萍说<br>c = “你幸福吗？”<br>aobama = Adapter:new()<br>—奥爸妈实际听到的是<br>aobama:Listen(c)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#36755;&#20986;&#32467;&#26524;&#65306;  &#10;Are you happy?  &#10;&#10;&#10;&#10;&#10;###5&#12289;&#32452;&#21512;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—[[<br>    组合模式使得用户对单个对象和组合对象的使用具有一致性。  </p>
<pre><code>应用：  
<span class="number">1</span>．你想表示对象的部分-整体层次结构  
<span class="number">2</span>．你希望用户忽略组合对象与单个对象的不同，用户将统一地使用组合结构中的所有对象。  

定义：  
<span class="number">1</span><span class="class">.Component</span> 是组合中的对象声明接口，在适当的情况下，实现所有类共有接口的默认行为。声明一个接口用于访问和管理Component子部件。  
<span class="number">2</span><span class="class">.Leaf</span> 在组合中表示叶子结点对象，叶子结点没有子结点。  
<span class="number">3</span><span class="class">.Composite</span> 定义有枝节点行为，用来存储子部件，在Component接口中实现与子部件有关操作，如增加(add)和删除(remove)等。  
</code></pre><p>]]—  </p>
<p>Component = {}  </p>
<p>function Component:new(name)<br>    o = {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.name = name<br>    return o;<br>end  </p>
<p>Composite = Component:new()  </p>
<p>function Composite:new(name)<br>    o = {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.children = {}<br>    o.name = name<br>    return o;<br>end  </p>
<p>function Composite:Add(c)<br>    table.insert(self.children,c)<br>end  </p>
<p>function Composite:Remove(c)<br>    for k,v in pairs(self.children) do<br>        if v == c then<br>            table.remove(self.children,k)<br>        end<br>    end<br>end  </p>
<p>function Composite:Fuck()<br>    —print(self.name)<br>    for _,v in pairs(self.children) do<br>        v:Fuck()<br>    end<br>end  </p>
<p>function Composite:Announce()<br>    print(self.name)<br>    for _,v in pairs(self.children) do<br>        v:Announce()<br>    end<br>end  </p>
<p>Leaf = Component:new()  </p>
<p>function Leaf:new(name)<br>    o = {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.name = name<br>    return o;<br>end  </p>
<p>function Leaf:Fuck()<br>    print(“法克油,”..self.name)<br>end  </p>
<p>function Leaf:Announce()<br>    print(self.name..”,今天是我们一头汗集团正式进军海外的第一天，希望大家更加用心工作”)<br>end<br>—<strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong> 实例一 <strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong><br>chenguanxi = Composite:new(“陈冠稀”)<br>first = Composite:new(“第一批曝光”)<br>first:Add(Leaf:new(“张伯芝”))<br>first:Add(Leaf:new(“钟欣同”))<br>chenguanxi:Add(first)  </p>
<p>second = Composite:new(“第二批曝光”)<br>second:Add(Leaf:new(“陈文援”))<br>chenguanxi:Add(second)<br>chenguanxi:Fuck()  </p>
<p>—<strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong> 实例二 <strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong><br>yitouhan = Composite:new(“一头汗集团广州总部”)<br>yitouhan:Add(Leaf:new(“人力资源部”))<br>yitouhan:Add(Leaf:new(“程序部”))<br>yitouhan:Add(Leaf:new(“运营部”))<br>yitouhan:Add(Leaf:new(“运维部”))  </p>
<p>shenzhen = Composite:new(“一头汗集团深圳分部”)<br>shenzhen:Add(Leaf:new(“人力资源部”))<br>shenzhen:Add(Leaf:new(“程序部”))<br>shenzhen:Add(Leaf:new(“港澳台合作部”))  </p>
<p>beijing  = Composite:new(“一头汗集团北京分部”)<br>beijing:Add(Leaf:new(“人力资源部”))<br>beijing:Add(Leaf:new(“程序部”))  </p>
<p>shanghai = Composite:new(“一头汗集团上海分部”)<br>shanghai:Add(Leaf:new(“人力资源部”))<br>shanghai:Add(Leaf:new(“程序部”))  </p>
<p>yitouhan:Add(shenzhen)<br>yitouhan:Add(beijing)<br>yitouhan:Add(shanghai)  </p>
<p>yitouhan:Announce()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#36755;&#20986;&#32467;&#26524;&#65306;  &#10;&#27861;&#20811;&#27833;,&#24352;&#20271;&#33437;  &#10;&#27861;&#20811;&#27833;,&#38047;&#27427;&#21516;  &#10;&#27861;&#20811;&#27833;,&#38472;&#25991;&#25588;  &#10;&#19968;&#22836;&#27735;&#38598;&#22242;&#24191;&#24030;&#24635;&#37096;  &#10;&#20154;&#21147;&#36164;&#28304;&#37096;,&#20170;&#22825;&#26159;&#25105;&#20204;&#19968;&#22836;&#27735;&#38598;&#22242;&#27491;&#24335;&#36827;&#20891;&#28023;&#22806;&#30340;&#31532;&#19968;&#22825;&#65292;&#24076;&#26395;&#22823;&#23478;&#26356;&#21152;&#29992;&#24515;&#24037;&#20316;  &#10;&#31243;&#24207;&#37096;,&#20170;&#22825;&#26159;&#25105;&#20204;&#19968;&#22836;&#27735;&#38598;&#22242;&#27491;&#24335;&#36827;&#20891;&#28023;&#22806;&#30340;&#31532;&#19968;&#22825;&#65292;&#24076;&#26395;&#22823;&#23478;&#26356;&#21152;&#29992;&#24515;&#24037;&#20316;  &#10;&#36816;&#33829;&#37096;,&#20170;&#22825;&#26159;&#25105;&#20204;&#19968;&#22836;&#27735;&#38598;&#22242;&#27491;&#24335;&#36827;&#20891;&#28023;&#22806;&#30340;&#31532;&#19968;&#22825;&#65292;&#24076;&#26395;&#22823;&#23478;&#26356;&#21152;&#29992;&#24515;&#24037;&#20316;  &#10;&#36816;&#32500;&#37096;,&#20170;&#22825;&#26159;&#25105;&#20204;&#19968;&#22836;&#27735;&#38598;&#22242;&#27491;&#24335;&#36827;&#20891;&#28023;&#22806;&#30340;&#31532;&#19968;&#22825;&#65292;&#24076;&#26395;&#22823;&#23478;&#26356;&#21152;&#29992;&#24515;&#24037;&#20316;  &#10;&#19968;&#22836;&#27735;&#38598;&#22242;&#28145;&#22323;&#20998;&#37096;  &#10;&#20154;&#21147;&#36164;&#28304;&#37096;,&#20170;&#22825;&#26159;&#25105;&#20204;&#19968;&#22836;&#27735;&#38598;&#22242;&#27491;&#24335;&#36827;&#20891;&#28023;&#22806;&#30340;&#31532;&#19968;&#22825;&#65292;&#24076;&#26395;&#22823;&#23478;&#26356;&#21152;&#29992;&#24515;&#24037;&#20316;  &#10;&#31243;&#24207;&#37096;,&#20170;&#22825;&#26159;&#25105;&#20204;&#19968;&#22836;&#27735;&#38598;&#22242;&#27491;&#24335;&#36827;&#20891;&#28023;&#22806;&#30340;&#31532;&#19968;&#22825;&#65292;&#24076;&#26395;&#22823;&#23478;&#26356;&#21152;&#29992;&#24515;&#24037;&#20316;  &#10;&#28207;&#28595;&#21488;&#21512;&#20316;&#37096;,&#20170;&#22825;&#26159;&#25105;&#20204;&#19968;&#22836;&#27735;&#38598;&#22242;&#27491;&#24335;&#36827;&#20891;&#28023;&#22806;&#30340;&#31532;&#19968;&#22825;&#65292;&#24076;&#26395;&#22823;&#23478;&#26356;&#21152;&#29992;&#24515;&#24037;&#20316;  &#10;&#19968;&#22836;&#27735;&#38598;&#22242;&#21271;&#20140;&#20998;&#37096;  &#10;&#20154;&#21147;&#36164;&#28304;&#37096;,&#20170;&#22825;&#26159;&#25105;&#20204;&#19968;&#22836;&#27735;&#38598;&#22242;&#27491;&#24335;&#36827;&#20891;&#28023;&#22806;&#30340;&#31532;&#19968;&#22825;&#65292;&#24076;&#26395;&#22823;&#23478;&#26356;&#21152;&#29992;&#24515;&#24037;&#20316;  &#10;&#31243;&#24207;&#37096;,&#20170;&#22825;&#26159;&#25105;&#20204;&#19968;&#22836;&#27735;&#38598;&#22242;&#27491;&#24335;&#36827;&#20891;&#28023;&#22806;&#30340;&#31532;&#19968;&#22825;&#65292;&#24076;&#26395;&#22823;&#23478;&#26356;&#21152;&#29992;&#24515;&#24037;&#20316;  &#10;&#19968;&#22836;&#27735;&#38598;&#22242;&#19978;&#28023;&#20998;&#37096;  &#10;&#20154;&#21147;&#36164;&#28304;&#37096;,&#20170;&#22825;&#26159;&#25105;&#20204;&#19968;&#22836;&#27735;&#38598;&#22242;&#27491;&#24335;&#36827;&#20891;&#28023;&#22806;&#30340;&#31532;&#19968;&#22825;&#65292;&#24076;&#26395;&#22823;&#23478;&#26356;&#21152;&#29992;&#24515;&#24037;&#20316;  &#10;&#31243;&#24207;&#37096;,&#20170;&#22825;&#26159;&#25105;&#20204;&#19968;&#22836;&#27735;&#38598;&#22242;&#27491;&#24335;&#36827;&#20891;&#28023;&#22806;&#30340;&#31532;&#19968;&#22825;&#65292;&#24076;&#26395;&#22823;&#23478;&#26356;&#21152;&#29992;&#24515;&#24037;&#20316;  &#10;&#10;&#10;&#10;&#10;###6&#12289;&#26725;&#25509;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—[[<br>    桥接模式：将抽象部分与它的实现部分分离，使它们都可以独立地变化。<br>    其实桥接模式在开发应用中使用的非常广泛，甚至即使我们没有学过桥接模式，也可能会潜意识地使用到。<br>    例如：在游戏开发中，玩家类(Role)合成了背包(Knapsack)；在背包类(Knapsack)中，又合成的物品(Item)；其实这种合成就是桥接模式中的”桥“。注意的是这里是合成，而不是继承！<br>    下面以手机为例<br>]]—  </p>
<p>System = {}  </p>
<p>function System:new(n)<br>    o = {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.phonename = n<br>    return o;<br>end  </p>
<p>function System:GetSystem()<br>    if self.phonename == “Iphone5s” then<br>        return “IOS 7”<br>    elseif self.phonename == “Lumia1020” then<br>        return “WP 8”<br>    end<br>end  </p>
<p>CPU = {}  </p>
<p>function CPU:new(n)<br>    o = {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.phonename = n<br>    return o;<br>end  </p>
<p>function CPU:GetCPU()<br>    if self.phonename == “Iphone5s” then<br>        return “苹果 A7/M7协处理器”<br>    elseif self.phonename == “Lumia1020” then<br>        return “高通 Adreno 225”<br>    end<br>end  </p>
<p>Memory = {}  </p>
<p>function Memory:new(n)<br>    o = {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.phonename = n<br>    return o;<br>end  </p>
<p>function Memory:GetMemory()<br>    if self.phonename == “Iphone5s” then<br>        return “RAM容量：1GB “<br>    elseif self.phonename == “Lumia1020” then<br>        return “RAM容量：2GB”<br>    end<br>end  </p>
<p>Cellphone = {}  </p>
<p>function Cellphone:new(n,o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    self.system = System:new(n)<br>    self.cpu = CPU:new(n)<br>    self.memory = Memory:new(n)<br>    self.phonename = n<br>    return o;<br>end  </p>
<p>function Cellphone:ShowDetail()<br>    print(self.phonename)<br>    print(self.system:GetSystem())<br>    print(self.cpu:GetCPU())<br>    print(self.memory:GetMemory())<br>end  </p>
<p>Iphone5s = Cellphone:new()  </p>
<p>function Iphone5s:Description()<br>    print(“就三个字，’土豪金’”)<br>end  </p>
<p>Lumia1020 = Cellphone:new()  </p>
<p>function Lumia1020:Description()<br>    print(“最好的相机手机，诺基亚，质量的保证”)<br>end  </p>
<p>phone = Iphone5s:new(“Iphone5s”)<br>phone:Description()<br>phone:ShowDetail()  </p>
<p>phone = Lumia1020:new(“Lumia1020”)<br>phone:Description()<br>phone:ShowDetail()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#36755;&#20986;&#32467;&#26524;&#65306;  &#10;&#23601;&#19977;&#20010;&#23383;&#65292;&#39;&#22303;&#35946;&#37329;&#39;  &#10;Iphone5s  &#10;IOS 7  &#10;&#33529;&#26524; A7/M7&#21327;&#22788;&#29702;&#22120;  &#10;RAM&#23481;&#37327;&#65306;1GB  &#10;&#26368;&#22909;&#30340;&#30456;&#26426;&#25163;&#26426;&#65292;&#35834;&#22522;&#20122;&#65292;&#36136;&#37327;&#30340;&#20445;&#35777;  &#10;Lumia1020  &#10;WP 8  &#10;&#39640;&#36890; Adreno 225  &#10;RAM&#23481;&#37327;&#65306;2GB  &#10;&#10;&#10;&#10;&#10;###7&#12289;&#20139;&#20803;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—[[<br>    设计模式中的享元模式，避免大量拥有相同内容的小类的开销(如耗费内存),使大家共享一个类(元类).<br>    它使用共享物件，用来尽可能减少内存使用量以及分享资讯给尽可能多的相似物件；它适合用于当大量物件只是重复因而导致无法令人接受的使用大量内存。<br>    抽象享元(Flyweight)角色：此角色是所有的具体享元类的超类，为这些类规定出需要实现的公共接口。那些需要外蕴状态(External State)的操作可以通过调用商业方法以参数形式传入。  </p>
<pre><code>具体享元<span class="comment">(ConcreteFlyweight)</span>角色：实现抽象享元角色所规定的接口。如果有内蕴状态的话，必须负责为内蕴状态提供存储空间。享元对象的内蕴状态必须与对象所处的周围环境无关，从而使得享元对象可以在系统内共享的。  

享元工厂<span class="comment">(FlyweightFactory)</span>角色：本角色负责创建和管理享元角色。本角色必须保证享元对象可以被系统适当地共享。当一个客户端对象调用一个享元对象的时候，享元工厂角色会检查系统中是否已经有一个复合要求的享元对象。如果已经有了，享元工厂角色就应当提供这个已有的享元对象；如果系统中没有一个适当的享元对象的话，享元工厂角色就应当创建一个合适的享元对象。  
</code></pre><p>]]—  </p>
<p>FlyweightFactory = {}  </p>
<p>function FlyweightFactory:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.flyweight = {}<br>    o.flyweight[“male”] = ConcreteFlyweight1:new()<br>    o.flyweight[“female”] = ConcreteFlyweight2:new()<br>    return o;<br>end  </p>
<p>function FlyweightFactory:GetFlyweight(key)<br>    if key ~= nil then<br>        return self.flyweight[key]<br>    end<br>end  </p>
<p>Flyweight = {}  </p>
<p>function Flyweight:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o<br>end  </p>
<p>function Flyweight:Operation()<br>    print(“base operation”)<br>end  </p>
<p>function Flyweight:SetName(n)<br>    self.name = n<br>    return self<br>end  </p>
<p>ConcreteFlyweight1 = Flyweight:new()  </p>
<p>function ConcreteFlyweight1:Operation(state)<br>    print(self.name..” 追求 “..state.name)<br>end   </p>
<p>ConcreteFlyweight2 = Flyweight:new()  </p>
<p>function ConcreteFlyweight2:Operation(state)<br>    print(self.name..” 喜欢 “..state.name)<br>end  </p>
<p>UnsharedConcreteFlyweight = Flyweight:new()  </p>
<p>function UnsharedConcreteFlyweight:Operation(state)<br>    —这里是不需要共享的操作<br>    print(state)<br>end  </p>
<p>print(“月老牵红线……”)  </p>
<p>f = FlyweightFactory:new()<br>xietingfeng = f:GetFlyweight(“male”):SetName(“谢霆疯”)<br>zhangbozhi = f:GetFlyweight(“female”):SetName(“张伯芝”)<br>xietingfeng:Operation(zhangbozhi)<br>zhangbozhi:Operation(xietingfeng)  </p>
<p>zhubajie = f:GetFlyweight(“male”):SetName(“猪八戒”)<br>change = f:GetFlyweight(“female”):SetName(“嫦娥”)<br>zhubajie:Operation(change)<br>change:Operation(zhubajie)  </p>
<p>xietingfeng = UnsharedConcreteFlyweight:new()<br>xietingfeng:Operation(“谢霆疯:我后悔了”)  </p>
<p>zhubajie = UnsharedConcreteFlyweight:new()<br>zhubajie:Operation(“猪八戒:感谢月老”)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#36755;&#20986;&#32467;&#26524;&#65306;  &#10;&#26376;&#32769;&#29301;&#32418;&#32447;......  &#10;&#35874;&#38662;&#30127; &#36861;&#27714; &#24352;&#20271;&#33437;  &#10;&#24352;&#20271;&#33437; &#21916;&#27426; &#35874;&#38662;&#30127;  &#10;&#29482;&#20843;&#25106; &#36861;&#27714; &#23270;&#23077;  &#10;&#23270;&#23077; &#21916;&#27426; &#29482;&#20843;&#25106;  &#10;&#35874;&#38662;&#30127;:&#25105;&#21518;&#24724;&#20102;  &#10;&#29482;&#20843;&#25106;:&#24863;&#35874;&#26376;&#32769;  &#10;&#10;&#10;&#10;&#10;&#10;&#10; - &#34892;&#20026;&#27169;&#24335;&#10;============================&#10;&#10;###1&#12289;&#31574;&#30053;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>Strategy = {}<br>ConcreteStrategyA = {}<br>ConcreteStrategyB = {}<br>ConcreteStrategyC = {}<br>Context = {strategy = nil}  </p>
<p>function Strategy:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o;<br>end  </p>
<p>function Strategy:AlgorithmInterface()<br>    print(“逻辑接口”)<br>end  </p>
<p>ConcreteStrategyA = Strategy:new()  </p>
<p>function ConcreteStrategyA:AlgorithmInterface()<br>    print(“具体策略A”)<br>end  </p>
<p>function Context:new(o,s)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    if s ~= nil then<br>        o.strategy = s<br>    end<br>    return o;<br>end  </p>
<p>function Context:ContextInterface()<br>    self.strategy:AlgorithmInterface()<br>end  </p>
<p>context = Context:new({},ConcreteStrategyA:new())<br>context:ContextInterface()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#19978;&#38754;&#30340;&#20195;&#30721;&#30340;&#36755;&#20986;&#32467;&#26524;&#26159;&#65306;&#20855;&#20307;&#30340;&#31574;&#30053;A  &#10;&#22914;&#26524;&#20320;&#25226;&#10;function ConcreteStrategyA:AlgorithmInterface()&#10;&#27880;&#37322;&#25481;&#65292;&#36755;&#20986;&#30340;&#32467;&#26524;&#24212;&#35813;&#23601;&#20250;&#26159;&#65306;&#36923;&#36753;&#25509;&#21475;&#12290;&#10;&#10;&#10;&#10;###2&#12289;&#27169;&#26495;&#26041;&#27861;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—模板方法模式是通过把不变行为搬移到基类，去除之类中的重复代码来体现它的优势。<br>—下面以考试试卷为例，试题都是一样的，但是答案可能不一样  </p>
<p>TestPaper = {}  </p>
<p>function TestPaper:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o;<br>end  </p>
<p>function TestPaper:TestQuestion1()<br>    print(“孙悟空的师弟是谁？”)<br>    print(“A 猪七戒        B 猪八戒             C 猪九戒”)<br>    print(“答案是:”..self:Answer1())<br>end  </p>
<p>function TestPaper:Answer1()<br>    return “”<br>end  </p>
<p>function TestPaper:TestQuestion2()<br>    print(“猪八戒的师弟是谁？”)<br>    print(“A 沙和尚        B 沙道士             C 沙井盖”)<br>    print(“答案是:”..self:Answer2())<br>end  </p>
<p>function TestPaper:Answer2()<br>    return “”<br>end  </p>
<p>function TestPaper:TestQuestion3()<br>    print(“沙和尚的大师兄是谁？”)<br>    print(“A 孙中山        B 孙权        C 孙悟空”)<br>    print(“答案是:”..self:Answer3())<br>end  </p>
<p>function TestPaper:Answer3()<br>    return “”<br>end  </p>
<p>—小组A的试卷<br>GroupATestPaper = TestPaper:new()  </p>
<p>function GroupATestPaper:Answer1()<br>    return “B”<br>end  </p>
<p>function GroupATestPaper:Answer2()<br>    return “C”<br>end  </p>
<p>function GroupATestPaper:Answer3()<br>    return “A”<br>end  </p>
<p>—小组B的试卷<br>GroupBTestPaper = TestPaper:new()  </p>
<p>function GroupBTestPaper:Answer1()<br>    return “A”<br>end  </p>
<p>function GroupBTestPaper:Answer2()<br>    return “B”<br>end  </p>
<p>function GroupBTestPaper:Answer3()<br>    return “C”<br>end  </p>
<p>—小明是小组A的一员<br>print(“<strong><em>**</em></strong>小明的试卷<strong><strong>*</strong></strong>“)<br>XiaoMingTestPaper = GroupATestPaper:new()<br>XiaoMingTestPaper:TestQuestion1()<br>XiaoMingTestPaper:TestQuestion2()<br>XiaoMingTestPaper:TestQuestion3()  </p>
<p>—小红是小组B的一员<br>print(“<strong><em>**</em></strong>小红的试卷<strong><strong>*</strong></strong>“)<br>XiaoHongTestPaper = GroupBTestPaper:new()<br>XiaoHongTestPaper:TestQuestion1()<br>XiaoHongTestPaper:TestQuestion2()<br>XiaoHongTestPaper:TestQuestion3()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#36755;&#20986;&#32467;&#26524;&#26159;:  &#10;********&#23567;&#26126;&#30340;&#35797;&#21367;*********  &#10;&#23385;&#24735;&#31354;&#30340;&#24072;&#24351;&#26159;&#35841;&#65311;  &#10;A &#29482;&#19971;&#25106;  B &#29482;&#20843;&#25106; C &#29482;&#20061;&#25106;  &#10;&#31572;&#26696;&#26159;:B  &#10;&#29482;&#20843;&#25106;&#30340;&#24072;&#24351;&#26159;&#35841;&#65311;  &#10;A &#27801;&#21644;&#23578;  B &#27801;&#36947;&#22763; C &#27801;&#20117;&#30422;  &#10;&#31572;&#26696;&#26159;:C  &#10;&#27801;&#21644;&#23578;&#30340;&#22823;&#24072;&#20804;&#26159;&#35841;&#65311;  &#10;A &#23385;&#20013;&#23665;  B &#23385;&#26435;     C &#23385;&#24735;&#31354;  &#10;&#31572;&#26696;&#26159;:A  &#10;********&#23567;&#32418;&#30340;&#35797;&#21367;*********  &#10;&#23385;&#24735;&#31354;&#30340;&#24072;&#24351;&#26159;&#35841;&#65311;  &#10;A &#29482;&#19971;&#25106;  B &#29482;&#20843;&#25106; C &#29482;&#20061;&#25106;  &#10;&#31572;&#26696;&#26159;:A  &#10;&#29482;&#20843;&#25106;&#30340;&#24072;&#24351;&#26159;&#35841;&#65311;  &#10;A &#27801;&#21644;&#23578;  B &#27801;&#36947;&#22763; C &#27801;&#20117;&#30422;  &#10;&#31572;&#26696;&#26159;:B  &#10;&#27801;&#21644;&#23578;&#30340;&#22823;&#24072;&#20804;&#26159;&#35841;&#65311;  &#10;A &#23385;&#20013;&#23665;  B &#23385;&#26435;     C &#23385;&#24735;&#31354;  &#10;&#31572;&#26696;&#26159;:C  &#10;&#10;&#10;&#10;&#10;###3&#12289;&#35266;&#23519;&#32773;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—[[<br>        抽象主题（Subject）角色：主题角色把所有对观察考对象的引用保存在一个聚集里，<br>    每个主题都可以有任何数量的观察者。抽象主题提供一个接口，可以增加和删除观察者对<br>    象，主题角色又叫做抽象被观察者（Observable）角色，一般用一个抽象类或者一个接口<br>    实现。<br>        抽象观察者（Observer）角色：为所有的具体观察者定义一个接口，在得到主题的通<br>    知时更新自己。这个接口叫做更新接口。抽象观察者角色一般用一个抽象类或者一个接口<br>    实现。在这个示意性的实现中，更新接口只包含一个方法（即Update()方法），这个方法<br>    叫做更新方法。<br>        具体主题（ConcreteSubject）角色：将有关状态存入具体现察者对象；在具体主题<br>    的内部状态改变时，给所有登记过的观察者发出通知。具体主题角色又叫做具体被观察者<br>    角色（Concrete Observable）。具体主题角色通常用一个具体子类实现。<br>        具体观察者（ConcreteObserver）角色：存储与主题的状态自恰的状态。具体现察者<br>    角色实现抽象观察者角色所要求的更新接口，以便使本身的状态与主题的状态相协调。如<br>    果需要，具体现察者角色可以保存一个指向具体主题对象的引用。具体观察者角色通常用<br>    一个具体子类实现。<br>]]—  </p>
<p>Subject = {}  </p>
<p>function Subject:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o<br>end  </p>
<p>ConcreteSubject = Subject:new()  </p>
<p>function ConcreteSubject:Attach(theconcreteobserver)<br>    if self.observers == nil then<br>        self.observers = {}<br>    end<br>    table.insert(self.observers,theconcreteobserver)<br>end  </p>
<p>function ConcreteSubject:Detach(theconcreteobserver)<br>    for k, v in pairs(self.observers) do<br>        if v == theconcreteobserver then<br>            table.remove(self.observers,k)<br>            break<br>        end<br>    end<br>end  </p>
<p>function ConcreteSubject:Notify()<br>    for _, v in pairs(self.observers) do<br>        v:Update()<br>    end<br>end  </p>
<p>Observer = {}  </p>
<p>function Observer:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o<br>end  </p>
<p>ConcreteObserver = Observer:new()  </p>
<p>function ConcreteObserver:new(s,n)<br>    o = {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.subject = s<br>    o.observername = n<br>    return o<br>end  </p>
<p>function ConcreteObserver:Update()<br>    print(“陈冠稀大喊：”..self.observername..”!!”..self.subject.subjectstate)<br>end  </p>
<p>s = ConcreteSubject:new()  </p>
<p>s:Attach(ConcreteObserver:new(s,”张伯芝”))<br>zhongxintong = ConcreteObserver:new(s,”钟欣同”)<br>chenwenyuan  = ConcreteObserver:new(s,”陈文援”)<br>s:Attach(zhongxintong)<br>s:Attach(chenwenyuan)<br>s.subjectstate = “谢霆疯来了,快躲起来!!”<br>s:Notify()  </p>
<p>s:Detach(zhongxintong)<br>s:Detach(chenwenyuan)<br>s.subjectstate = “谢霆疯走了,快回家!!”<br>s:Notify()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#36755;&#20986;&#32467;&#26524;&#65306;  &#10;&#38472;&#20896;&#31232;&#22823;&#21898;&#65306;&#24352;&#20271;&#33437;!!&#35874;&#38662;&#30127;&#26469;&#20102;,&#24555;&#36530;&#36215;&#26469;!!  &#10;&#38472;&#20896;&#31232;&#22823;&#21898;&#65306;&#38047;&#27427;&#21516;!!&#35874;&#38662;&#30127;&#26469;&#20102;,&#24555;&#36530;&#36215;&#26469;!!  &#10;&#38472;&#20896;&#31232;&#22823;&#21898;&#65306;&#38472;&#25991;&#25588;!!&#35874;&#38662;&#30127;&#26469;&#20102;,&#24555;&#36530;&#36215;&#26469;!!  &#10;&#38472;&#20896;&#31232;&#22823;&#21898;&#65306;&#24352;&#20271;&#33437;!!&#35874;&#38662;&#30127;&#36208;&#20102;,&#24555;&#22238;&#23478;!!  &#10;&#10;&#10;&#10;&#10;&#10;###4&#12289;&#29366;&#24577;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—[[<br>    状态模式(State Pattern)是设计模式的一种，属于行为模式。<br>    适用场景：<br>    1.一个对象的行为取决于它的状态，并且它必须在运行时刻根据状态改变它的行为。<br>    2.一个操作中含有庞大的多分支结构，并且这些分支决定于对象的状态。  </p>
<p>]]—  </p>
<p>Work = {}  </p>
<p>function Work:new(o,s)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.hour = 0<br>    o.currentstate = s<br>    return o;<br>end  </p>
<p>function Work:SetTime(h)<br>    self.hour = h<br>end  </p>
<p>function Work:GetTime()<br>    return self.hour<br>end  </p>
<p>function Work:SetState(s)<br>    self.currentstate = s<br>end  </p>
<p>function Work:WriteProgram()<br>    self.currentstate:WriteProgram(self)<br>end  </p>
<p>State = {}  </p>
<p>function State:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o;<br>end  </p>
<p>MorningState = State:new()  </p>
<p>function MorningState:WriteProgram(w)<br>    if w.hour &lt; 12 and w.hour &gt;= 9 then<br>        print(“早上写代码，精神百倍”)<br>    else<br>        w:SetState(NoonState:new())<br>        w:WriteProgram()<br>    end<br>end  </p>
<p>NoonState = State:new()  </p>
<p>function NoonState:WriteProgram(w)<br>    if w.hour &lt; 14 and w.hour &gt;= 12 then<br>        print(“中午写代码，犯困了，先小睡一下再说”)<br>    else<br>        w:SetState(AfternoonState:new())<br>        w:WriteProgram()<br>    end<br>end  </p>
<p>AfternoonState = State:new()  </p>
<p>function AfternoonState:WriteProgram(w)<br>    if w.hour &lt; 17 and w.hour &gt;= 14 then<br>        print(“下午写代码, 精神充足”)<br>    else<br>        w:SetState(EveningState:new())<br>        w:WriteProgram()<br>    end<br>end  </p>
<p>EveningState = State:new()  </p>
<p>function EveningState:WriteProgram(w)<br>    if w.hour &lt; 20 and w.hour &gt;=17 then<br>        print(“傍晚写代码，有点累，但还是继续”)<br>    else<br>        w:SetState(NightState:new())<br>        w:WriteProgram()<br>    end<br>end  </p>
<p>NightState = State:new()  </p>
<p>function NightState:WriteProgram(w)<br>    if w.hour &lt; 22 and w.hour &gt;= 20 then<br>        print(“晚上写代码，苦逼啊”)<br>    else<br>        w:SetState(MidnightState:new())<br>        w:WriteProgram()<br>    end<br>end  </p>
<p>MidnightState = State:new()  </p>
<p>function MidnightState:WriteProgram(w)<br>    if w.hour &lt; 9 or w.hour &gt;= 22 then<br>        print(“深夜写代码，尼玛，先睡醒了再说”)<br>    else<br>        w:SetState(MorningState:new())<br>        w:WriteProgram()<br>    end<br>end  </p>
<p>w = Work:new(nil,MorningState:new())<br>w:SetTime(21)<br>w:WriteProgram()  </p>
<p>w:SetTime(18)<br>w:WriteProgram()  </p>
<p>w:SetTime(10)<br>w:WriteProgram()  </p>
<p>w:SetTime(13)<br>w:WriteProgram()  </p>
<p>w:SetTime(15)<br>w:WriteProgram()  </p>
<p>w:SetTime(23)<br>w:WriteProgram()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#36755;&#20986;&#32467;&#26524;&#65306;  &#10;&#26202;&#19978;&#20889;&#20195;&#30721;&#65292;&#33510;&#36924;&#21834;  &#10;&#20621;&#26202;&#20889;&#20195;&#30721;&#65292;&#26377;&#28857;&#32047;&#65292;&#20294;&#36824;&#26159;&#32487;&#32493;  &#10;&#26089;&#19978;&#20889;&#20195;&#30721;&#65292;&#31934;&#31070;&#30334;&#20493;  &#10;&#20013;&#21320;&#20889;&#20195;&#30721;&#65292;&#29359;&#22256;&#20102;&#65292;&#20808;&#23567;&#30561;&#19968;&#19979;&#20877;&#35828;  &#10;&#19979;&#21320;&#20889;&#20195;&#30721;, &#31934;&#31070;&#20805;&#36275;  &#10;&#28145;&#22812;&#20889;&#20195;&#30721;&#65292;&#23612;&#29595;&#65292;&#20808;&#30561;&#37266;&#20102;&#20877;&#35828;  &#10;&#10;&#10;&#10;&#10;&#10;###5&#12289;&#36845;&#20195;&#22120;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—[[<br>    访问一个聚合对象的内容而无需暴露它的内部表示<br>    支持对聚合对象的多种遍历<br>    为遍历不同的聚合结构提供一个统一的接口  </p>
<pre><code><span class="comment">应用：</span>  
<span class="comment">最经典莫过于C</span><span class="literal">+</span><span class="literal">+</span> <span class="comment">STL了</span>  
</code></pre><p>]]—  </p>
<p>Iterator = {}  </p>
<p>function Iterator:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o;<br>end  </p>
<p>ConcreteIterator = Iterator:new()  </p>
<p>function ConcreteIterator:new(d)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.data = d<br>    o.index = 1;                —初始化索引<br>    o.size = table.getn(d)<br>    return o;<br>end  </p>
<p>function ConcreteIterator:Next()<br>    self.index = self.index + 1<br>end  </p>
<p>function ConcreteIterator:IsDone()<br>    if self.index &gt; self.size then<br>        return true<br>    end<br>    return false<br>end  </p>
<p>function ConcreteIterator:GetItem()<br>    return self.data[self.index]<br>end  </p>
<p>Aggregate = {}  </p>
<p>function Aggregate:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o;<br>end  </p>
<p>ConcreteAggregate = Aggregate:new()  </p>
<p>function ConcreteAggregate:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.data = {}<br>    return o;<br>end  </p>
<p>function ConcreteAggregate:CreateIterator()<br>    return ConcreteIterator:new(self.data)<br>end  </p>
<p>function ConcreteAggregate:PushBack(d)<br>    table.insert(self.data,d)<br>end  </p>
<p>function ConcreteAggregate:Remove(d)<br>    for k,v in pairs(self.data) do<br>        if v == d then<br>            table.remove(self.data,k)<br>        end<br>    end<br>end  </p>
<p>aggregate = ConcreteAggregate:new()  </p>
<p>aggregate:PushBack(true)<br>aggregate:PushBack(“QQ群:”)<br>aggregate:PushBack(315249378)  </p>
<p>it = aggregate:CreateIterator()  </p>
<p>while it:IsDone() == false do<br>    print(it:GetItem())<br>    it:Next()<br>end<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#36755;&#20986;&#32467;&#26524;&#65306;  &#10;true  &#10;&#10;&#10;&#10;&#10;###6&#12289;&#22791;&#24536;&#24405;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—[[<br>    优点：<br>    1、有时一些发起人对象的内部信息必须保存在发起人对象以外的地方，但是必须要由发起人对象自己读取，这时，使用备忘录模式可以把复杂的发起人内部信息对其他的对象屏蔽起来，从而可以恰当地保持封装的边界。<br>    2、本模式简化了发起人类。发起人不再需要管理和保存其内部状态的一个个版本，客户端可以自行管理他们所需要的这些状态的版本。<br>    3、当发起人角色的状态改变的时候，有可能这个状态无效，这时候就可以使用暂时存储起来的备忘录将状态复原。  </p>
<pre><code>缺点：  
1、如果发起人角色的状态需要完整地存储到备忘录对象中，那么在资源消耗上面备忘录对象会很昂贵。  
2、当负责人角色将一个备忘录 存储起来的时候，负责人可能并不知道这个状态会占用多大的存储空间，从而无法提醒用户一个操作是否很昂贵。  
3、当发起人角色的状态改变的时候，有可能这个协议无效。如果状态改变的成功率不高的话，不如采取“假如”协议模式。  
</code></pre><p>]]—  </p>
<p>Originator = {}  </p>
<p>function Originator:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.state = {}<br>    return o;<br>end  </p>
<p>function Originator:SetState(k,s)<br>    if self.state == nil then<br>        self.state = {}<br>    end<br>    self.state[k] = s<br>end  </p>
<p>function Originator:ShowState()<br>    for _, v in pairs(self.state) do<br>        print(v)<br>    end<br>end  </p>
<p>function table_copy_table(ori_tab)<br>    if (type(ori_tab) ~= “table”) then<br>        return nil<br>    end<br>    local new_tab = {}<br>    for i,v in pairs(ori_tab) do<br>        local vtyp = type(v)<br>        if (vtyp == “table”) then<br>            new_tab[i] = table_copy_table(v)<br>        else<br>            new_tab[i] = v<br>        end<br>    end<br>    return new_tab<br>end  </p>
<p>function Originator:CreateMemento()<br>    o = Memento:new()  </p>
<pre><code>o.<span class="keyword">state</span> = table_copy_table(<span class="literal">self</span>.<span class="keyword">state</span>)  
return o  
</code></pre><p>end  </p>
<p>function Originator:SetMemento(o)<br>    self.state = o.state<br>end  </p>
<p>Memento = {}  </p>
<p>function Memento:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o;<br>end  </p>
<p>Caretaker = {}  </p>
<p>function Caretaker:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.memento = nil<br>    return o;<br>end  </p>
<p>print(“陈冠稀 和 张伯芝激战前”)<br>originator = Originator:new()<br>originator:SetState(“clothes”,”衣衫整齐”)<br>originator:SetState(“face”,”春光满面”)<br>originator:SetState(“hair”,”头发飘飞”)<br>originator:ShowState()<br>caretaker = Caretaker:new()<br>caretaker.memento = originator:CreateMemento()  </p>
<p>print(“高潮中……”)<br>originator:SetState(“clothes”,”衣衫褴褛”)<br>originator:SetState(“face”,”累容满面”)<br>originator:SetState(“hair”,”头发凌乱”)<br>originator:ShowState()  </p>
<p>print(“激战后……”)<br>originator:SetMemento(caretaker.memento)<br>originator:ShowState()  </p>
<p>print(“张伯芝回家”)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#36755;&#20986;&#32467;&#26524;&#65306;  &#10;&#38472;&#20896;&#31232; &#21644; &#24352;&#20271;&#33437;&#28608;&#25112;&#21069;  &#10;&#34915;&#34923;&#25972;&#40784;  &#10;&#26149;&#20809;&#28385;&#38754;  &#10;&#22836;&#21457;&#39128;&#39134;  &#10;&#39640;&#28526;&#20013;......  &#10;&#34915;&#34923;&#35124;&#35099;  &#10;&#32047;&#23481;&#28385;&#38754;  &#10;&#22836;&#21457;&#20940;&#20081;  &#10;&#28608;&#25112;&#21518;......  &#10;&#34915;&#34923;&#25972;&#40784;  &#10;&#26149;&#20809;&#28385;&#38754;  &#10;&#22836;&#21457;&#39128;&#39134;  &#10;&#24352;&#20271;&#33437;&#22238;&#23478;  &#10;&#10;&#10;&#10;&#10;&#10;###7&#12289;&#21629;&#20196;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—[[<br>    优点：<br>    1.降低对象之间的耦合度。<br>    2.新的命令可以很容易地加入到系统中。<br>    3.可以比较容易地设计一个组合命令。<br>    4.调用同一方法实现不同的功能。<br>    缺点：<br>    使用命令模式可能会导致某些系统有过多的具体命令类。因为针对每一个命令都需要设计一个具体命令类，因此某些系统可能需要大量具体命令类，这将影响命令模式的使用。  </p>
<pre><code>Command类：是一个抽象类，类中对需要执行的命令进行声明，一般来说要对外公布一个<span class="operator"><span class="keyword">execute</span>方法用来执行命令。  
ConcreteCommand类：Command类的实现类，对抽象类中声明的方法进行实现。  
Invoker类：调用者，负责调用命令。  
Receiver类：接收者，负责接收命令并且执行命令。  </span>
</code></pre><p>]]—  </p>
<p>Command = {}  </p>
<p>function Command:new(r,o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.receiver = r<br>    return o;<br>end  </p>
<p>ConcreteCommand1 = Command:new()  </p>
<p>function ConcreteCommand1:Execute()<br>    self.receiver:Action1()<br>end  </p>
<p>ConcreteCommand2 = Command:new()  </p>
<p>function ConcreteCommand2:Execute()<br>    self.receiver:Action2()<br>end  </p>
<p>Receiver = {}  </p>
<p>function Receiver:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o;<br>end  </p>
<p>function Receiver:Action1()<br>    print(“来一条清蒸鱼”)<br>end  </p>
<p>function Receiver:Action2()<br>    print(“来一个蛋糕”)<br>end  </p>
<p>Invoker = {}  </p>
<p>function Invoker:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.allcommand = {}<br>    return o;<br>end  </p>
<p>function Invoker:SetCommand(c)<br>    table.insert(self.allcommand,c)<br>end  </p>
<p>function Invoker:ExecuteCommand()<br>    for _,v in pairs(self.allcommand) do<br>        v:Execute()<br>    end<br>end<br>—厨师 是 Receiver<br>chef = Receiver:new()  </p>
<p>—下面是两个菜(命令)，执行者是Receiver(chef)<br>fish = ConcreteCommand1:new(chef)  </p>
<p>cake = ConcreteCommand2:new(chef)  </p>
<p>—调用者 是服务员<br>waiter = Invoker:new()  </p>
<p>—服务员下达了两个菜(命令)，执行者当然是Receiver(chef)<br>waiter:SetCommand(fish)<br>waiter:SetCommand(cake)  </p>
<p>—看似服务员做了两个菜，实际是Receiver做，从而做了解耦；客人与厨师不用相互紧耦合<br>waiter:ExecuteCommand()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#36755;&#20986;&#32467;&#26524;&#65306;  &#10;&#26469;&#19968;&#26465;&#28165;&#33976;&#40060;  &#10;&#26469;&#19968;&#20010;&#34507;&#31957;  &#10;&#10;&#10;&#10;&#10;&#10;###8&#12289;&#32844;&#36131;&#38142;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—[[<br>    职责链模式:使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。将这个对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。<br>    应用：<br>    1、有多个对象处理请求，到底怎么处理在运行时确定。<br>    2、希望在不明确指定接收者的情况下，向多个对象中的一个提交请求。<br>    3、可处理一个请求的对象集合应该被动态指定。<br>]]—  </p>
<p>Handler = {}  </p>
<p>function Handler:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o;<br>end  </p>
<p>function Handler:SetSuccessor(s)<br>    self.successor = s<br>end  </p>
<p>ConcreteHandler1 = Handler:new()  </p>
<p>function ConcreteHandler1:HandleRequest(r)<br>    if r &lt;= 10 then<br>        print(“Handler1处理了请求”)<br>    elseif self.successor then<br>        self.successor:HandleRequest(r)<br>    end  </p>
<p>end  </p>
<p>ConcreteHandler2 = Handler:new()  </p>
<p>function ConcreteHandler2:HandleRequest(r)<br>    if r &gt; 10 and r &lt;= 20 then<br>        print(“Handler2处理了请求”)<br>    elseif self.successor then<br>        self.successor:HandleRequest(r)<br>    end<br>end  </p>
<p>ConcreteHandler3 = Handler:new()  </p>
<p>function ConcreteHandler3:HandleRequest(r)<br>    if r &gt; 20 then<br>        print(“Handler3处理了请求”)<br>    elseif self.successor then<br>        self.successor:HandleRequest(r)<br>    end<br>end  </p>
<p>h1 = ConcreteHandler1:new()<br>h2 = ConcreteHandler2:new()<br>h3 = ConcreteHandler3:new()  </p>
<p>h1:SetSuccessor(h2)<br>h2:SetSuccessor(h3)  </p>
<p>print(“<strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong>实例一<strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong>“)<br>h1:HandleRequest(25)<br>h2:HandleRequest(5)<br>h3:HandleRequest(15)  </p>
<p>print(“<strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong>实例二<strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong>“)<br>h1:HandleRequest(25)<br>h1:HandleRequest(5)<br>h1:HandleRequest(15)<br>—[[<br>    PS:<br>    当时”弄懂”了职责链模式后，不禁心里大骂：尼玛，这不就是状态模式吗？！<br>    后来细心地发现了其中的不同：<br>    状态模式：后一个状态的处理对象早已在类的内部设定好了。<br>    职责链模式：后一个请求的处理对象由客户端来设定。  </p>
<p>]]—<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#36755;&#20986;&#32467;&#26524;&#65306;  &#10;*********************&#23454;&#20363;&#19968;***********************  &#10;Handler3&#22788;&#29702;&#20102;&#35831;&#27714;  &#10;*********************&#23454;&#20363;&#20108;***********************  &#10;Handler3&#22788;&#29702;&#20102;&#35831;&#27714;  &#10;Handler1&#22788;&#29702;&#20102;&#35831;&#27714;  &#10;Handler2&#22788;&#29702;&#20102;&#35831;&#27714;  &#10;&#10;&#10;&#10;&#10;&#10;###9&#12289;&#35299;&#37322;&#22120;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—[[<br>    解释器模式（Interpreter），给定一个语言，定义它的文法的一种表示，并定义一个解释器，用这个解释器使用该表示来解释语言中句子。<br>    解释器模式需要解决的是，如果一种特定类型的问题发生的频率足够高，那么可能就值得将该问题的各个实例表述为一个简单语言中的句子。这样就可以构建一个解释器，该解释器通过解释这些句子来解决该问题。<br>    AbstractExpression 抽象解释器：具体的解释任务由各个实现类完成，具体的解释器分别由TerminalExpression和NonterminalExpression完成。  </p>
<pre><code>TerminalExpression终结符表达式：实现与文法中的元素相关联的解释操作，通常一个解释器模式中只有一个终结符表达式，但有多个实例，对应不同的终结符。具体到我们例子就是VarExpression类，表达式中的每个终结符都在堆栈中产生了一个VarExpression对象。  

NonterminalExpression 非终结符表达式：文法中的每条规则对应于一个非终结表达式，具体到我们的例子就是加减法规则分别对应到AddExpression和SubExpression两个类。非终结符表达式根据逻辑的复杂程度而增加，原则上每个文法规则都对应一个非终结符表达式。  

<span class="keyword">Context</span> 环境角色：包含解释之外的一些全局信息。  
</code></pre><p>]]—  </p>
<p>Context = {}  </p>
<p>function Context:Sort(e)<br>    local index = 1<br>    local last = 1<br>    local sub = “”<br>    local num = 1<br>    local top = 1<br>    local stack = {}<br>    while 1 do<br>        last = string.find(e,” “,index)<br>        if last == nil or last &lt;= 0 then<br>            break<br>        end<br>        sub = string.sub(e,index,last)<br>        num = tonumber(sub)<br>        if num == nil then<br>            stack[top] = sub<br>        else<br>            stack[top] = num<br>        end<br>        top = top + 1<br>        index = last + 1<br>    end<br>    —table.foreach(stack,print)<br>    return stack<br>end  </p>
<p>function Context:new(e,o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.stack = {}<br>    o.top = 1       —顶指针<br>    o.expression = self:Sort(e)<br>    return o<br>end   </p>
<p>function Context:Calculate()<br>    self.top = 1<br>    local i = 1<br>    while 1 do<br>        if i &gt;= #self.expression then<br>            break<br>        end<br>        if string.find(self.expression[i],”+”) then<br>            self.stack[self.top - 1] = AddExpression:new(self.stack[self.top - 1],VarExpression:new(self.expression[i + 1]))<br>            i = i + 2<br>        elseif string.find(self.expression[i],”-“) then<br>            self.stack[self.top - 1] = SubExpression:new(self.stack[self.top - 1],VarExpression:new(self.expression[i + 1]))<br>            i = i + 2<br>        else<br>            self.stack[self.top] = VarExpression:new(self.expression[i])<br>            i = i + 1<br>            self.top = self.top + 1<br>        end<br>    end  </p>
<pre><code><span class="keyword">for</span> i = <span class="number">1</span>,<span class="keyword">self</span>.top - <span class="number">1</span>,<span class="number">1</span> <span class="keyword">do</span>  
    print(<span class="keyword">self</span>.stack[i]<span class="symbol">:Interpret</span>())  
<span class="keyword">end</span>  
</code></pre><p>end  </p>
<p>AbstractExpression = {}  </p>
<p>function AbstractExpression:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    return o<br>end  </p>
<p>TerminalExpression = AbstractExpression:new()  </p>
<p>function TerminalExpression:new(v,o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.val = v<br>    return o<br>end  </p>
<p>function TerminalExpression:Interpret()<br>    return self.val<br>end  </p>
<p>VarExpression = TerminalExpression:new()  </p>
<p>NonterminalExpression = AbstractExpression:new()  </p>
<p>function NonterminalExpression:new(l,r,o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.left = l<br>    o.right = r<br>    return o<br>end  </p>
<p>AddExpression = NonterminalExpression:new()  </p>
<p>function AddExpression:Interpret(c)<br>    return self.left:Interpret() + self.right:Interpret()<br>end   </p>
<p>SubExpression = NonterminalExpression:new()  </p>
<p>function SubExpression:Interpret(c)<br>    return self.left:Interpret() - self.right:Interpret()<br>end   </p>
<p>c = Context:new(“1 + 9 - 3 + 5 “)<br>c:Calculate()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#36755;&#20986;&#32467;&#26524;&#65306;  &#10;12  &#10;&#10;&#10;&#10;&#10;&#10;&#10;###10&#12289;&#20013;&#20171;&#32773;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—[[<br>    Colleage抽象同事类。<br>    ConcreteColleage是具体同事类，每个具体同事只知道自己的行为，而不了解其他同事类的情况，但它们却都认识中介者对象。<br>    Mediator是抽象中介者，定义了同事对象到中介者对象的接口。<br>    ConcreteMediator是具体中介者对象，实现抽象类的方法，它需要知道所有具体同事类，并从具体同事接受消息，向具体同事对象发出命令。  </p>
<pre><code>优点是：  
各个 Colleague 减少了耦合。  

缺点是：  
由于 Mediator 控制了集中化，于是就把 Colleague 之间的交互复杂性变为了中介者的复杂性，也就是中介者会变的比任何一个 Colleague 都复杂。  
</code></pre><p>]]—  </p>
<p>—下面以六方会谈为背景<br>—这个会议相当于中介者  </p>
<p>Mediator = {}  </p>
<p>function Mediator:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.colleagues = {}<br>    return o;<br>end  </p>
<p>function Mediator:Send(c,message)<br>    for _,v in pairs(self.colleagues) do<br>        if v ~= c then<br>            v:GetMessage(message)<br>        end<br>    end<br>end  </p>
<p>ConcreteMediator = Mediator:new()  </p>
<p>Colleague = {}  </p>
<p>function Colleague:new(n,m,o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.mediator = m<br>    o.name = n<br>    return o;<br>end  </p>
<p>function Colleague:Send(message)<br>    print(self.name..”说:”..message)<br>    self.mediator:Send(self,message)<br>end  </p>
<p>function Colleague:GetMessage(message)<br>    print(self.name..”收到：”..message)<br>end  </p>
<p>China = Colleague:new()  </p>
<p>America = Colleague:new()  </p>
<p>Russia = Colleague:new()  </p>
<p>Japan = Colleague:new()  </p>
<p>SouthKorea = Colleague:new()  </p>
<p>NorthKorea = Colleague:new()  </p>
<p>liufang = ConcreteMediator:new()  </p>
<p>xijinping = China:new(“习近萍”,liufang)  </p>
<p>aobama = America:new(“奥爸妈”,liufang)  </p>
<p>pujing = Russia:new(“普惊”,liufang)  </p>
<p>anbeijinsan = Japan:new(“俺被进三”,liufang)  </p>
<p>piaojinhui = SouthKorea:new(“扑僅慧”,liufang)  </p>
<p>jinzhengen = NorthKorea:new(“金正嗯”,liufang)  </p>
<p>table.insert(liufang.colleagues,xijinping)  </p>
<p>table.insert(liufang.colleagues,aobama)  </p>
<p>table.insert(liufang.colleagues,pujing)  </p>
<p>table.insert(liufang.colleagues,anbeijinsan)  </p>
<p>table.insert(liufang.colleagues,piaojinhui)  </p>
<p>table.insert(liufang.colleagues,jinzhengen)  </p>
<p>xijinping:Send(“为了地区安全，我方支持半岛无核化”)<br>print(“”)<br>jinzhengen:Send(“如果我们放弃核武，我们就会被欺负”)<br>print(“”)<br>aobama:Send(“如果朝鲜继续发展核武，我国不排除武力去核”)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#20064;&#36817;&#33805;&#35828;:&#20026;&#20102;&#22320;&#21306;&#23433;&#20840;&#65292;&#25105;&#26041;&#25903;&#25345;&#21322;&#23707;&#26080;&#26680;&#21270;  &#10;&#22885;&#29240;&#22920;&#25910;&#21040;&#65306;&#20026;&#20102;&#22320;&#21306;&#23433;&#20840;&#65292;&#25105;&#26041;&#25903;&#25345;&#21322;&#23707;&#26080;&#26680;&#21270;  &#10;&#26222;&#24778;&#25910;&#21040;&#65306;&#20026;&#20102;&#22320;&#21306;&#23433;&#20840;&#65292;&#25105;&#26041;&#25903;&#25345;&#21322;&#23707;&#26080;&#26680;&#21270;  &#10;&#20474;&#34987;&#36827;&#19977;&#25910;&#21040;&#65306;&#20026;&#20102;&#22320;&#21306;&#23433;&#20840;&#65292;&#25105;&#26041;&#25903;&#25345;&#21322;&#23707;&#26080;&#26680;&#21270;  &#10;&#25169;&#20677;&#24935;&#25910;&#21040;&#65306;&#20026;&#20102;&#22320;&#21306;&#23433;&#20840;&#65292;&#25105;&#26041;&#25903;&#25345;&#21322;&#23707;&#26080;&#26680;&#21270;  &#10;&#37329;&#27491;&#21999;&#25910;&#21040;&#65306;&#20026;&#20102;&#22320;&#21306;&#23433;&#20840;&#65292;&#25105;&#26041;&#25903;&#25345;&#21322;&#23707;&#26080;&#26680;&#21270;  &#10;&#10;&#10;&#37329;&#27491;&#21999;&#35828;:&#22914;&#26524;&#25105;&#20204;&#25918;&#24323;&#26680;&#27494;&#65292;&#25105;&#20204;&#23601;&#20250;&#34987;&#27450;&#36127;  &#10;&#20064;&#36817;&#33805;&#25910;&#21040;&#65306;&#22914;&#26524;&#25105;&#20204;&#25918;&#24323;&#26680;&#27494;&#65292;&#25105;&#20204;&#23601;&#20250;&#34987;&#27450;&#36127;  &#10;&#22885;&#29240;&#22920;&#25910;&#21040;&#65306;&#22914;&#26524;&#25105;&#20204;&#25918;&#24323;&#26680;&#27494;&#65292;&#25105;&#20204;&#23601;&#20250;&#34987;&#27450;&#36127;  &#10;&#26222;&#24778;&#25910;&#21040;&#65306;&#22914;&#26524;&#25105;&#20204;&#25918;&#24323;&#26680;&#27494;&#65292;&#25105;&#20204;&#23601;&#20250;&#34987;&#27450;&#36127;  &#10;&#20474;&#34987;&#36827;&#19977;&#25910;&#21040;&#65306;&#22914;&#26524;&#25105;&#20204;&#25918;&#24323;&#26680;&#27494;&#65292;&#25105;&#20204;&#23601;&#20250;&#34987;&#27450;&#36127;  &#10;&#25169;&#20677;&#24935;&#25910;&#21040;&#65306;&#22914;&#26524;&#25105;&#20204;&#25918;&#24323;&#26680;&#27494;&#65292;&#25105;&#20204;&#23601;&#20250;&#34987;&#27450;&#36127;  &#10;&#10;&#10;&#22885;&#29240;&#22920;&#35828;:&#22914;&#26524;&#26397;&#40092;&#32487;&#32493;&#21457;&#23637;&#26680;&#27494;&#65292;&#25105;&#22269;&#19981;&#25490;&#38500;&#27494;&#21147;&#21435;&#26680;  &#10;&#20064;&#36817;&#33805;&#25910;&#21040;&#65306;&#22914;&#26524;&#26397;&#40092;&#32487;&#32493;&#21457;&#23637;&#26680;&#27494;&#65292;&#25105;&#22269;&#19981;&#25490;&#38500;&#27494;&#21147;&#21435;&#26680;  &#10;&#26222;&#24778;&#25910;&#21040;&#65306;&#22914;&#26524;&#26397;&#40092;&#32487;&#32493;&#21457;&#23637;&#26680;&#27494;&#65292;&#25105;&#22269;&#19981;&#25490;&#38500;&#27494;&#21147;&#21435;&#26680;  &#10;&#20474;&#34987;&#36827;&#19977;&#25910;&#21040;&#65306;&#22914;&#26524;&#26397;&#40092;&#32487;&#32493;&#21457;&#23637;&#26680;&#27494;&#65292;&#25105;&#22269;&#19981;&#25490;&#38500;&#27494;&#21147;&#21435;&#26680;  &#10;&#25169;&#20677;&#24935;&#25910;&#21040;&#65306;&#22914;&#26524;&#26397;&#40092;&#32487;&#32493;&#21457;&#23637;&#26680;&#27494;&#65292;&#25105;&#22269;&#19981;&#25490;&#38500;&#27494;&#21147;&#21435;&#26680;  &#10;&#37329;&#27491;&#21999;&#25910;&#21040;&#65306;&#22914;&#26524;&#26397;&#40092;&#32487;&#32493;&#21457;&#23637;&#26680;&#27494;&#65292;&#25105;&#22269;&#19981;&#25490;&#38500;&#27494;&#21147;&#21435;&#26680;  &#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;###11&#12289;&#35775;&#38382;&#32773;&#27169;&#24335;</span><br></pre></td></tr></table></figure></p>
<p>—[[<br>    1.Visitor 抽象访问者角色，为该对象结构中具体元素角色声明一个访问操作接口。该操作接口的名字和参数标识了发送访问请求给具体访问者的具体元素角色，这样访问者就可以通过该元素角色的特定接口直接访问它。<br>    2.ConcreteVisitor.具体访问者角色，实现Visitor声明的接口。<br>    3.Element 定义一个接受访问操作(accept())，它以一个访问者(Visitor)作为参数。<br>    4.ConcreteElement 具体元素，实现了抽象元素(Element)所定义的接受操作接口。<br>    5.ObjectStructure 结构对象角色，这是使用访问者模式必备的角色。它具备以下特性：能枚举它的元素；可以提供一个高层接口以允许访问者访问它的元素；如有需要，可以设计成一个复合对象或者一个聚集（如一个列表或无序集合）。<br>    访问者模式适用于数据结构相对稳定算法又易变化的系统。因为访问者模式使得算法操作增加变得容易。若系统数据结构对象易于变化，经常有新的数据对象增加进来，则不适合使用访问者模式。<br>]]—<br>Visitor = {}  </p>
<p>function Visitor:new(n,o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    self.name = n<br>    return o;<br>end  </p>
<p>ConcreteVisitor1 = Visitor:new()  </p>
<p>function ConcreteVisitor1:VisitConcreteElementA(c)<br>    print(c.name..” 被 “..self.name..”访问”)<br>end  </p>
<p>function ConcreteVisitor1:VisitConcreteElementB(c)<br>    print(c.name..” 被 “..self.name..”访问”)<br>end  </p>
<p>ConcreteVisitor2 = Visitor:new()  </p>
<p>function ConcreteVisitor2:VisitConcreteElementA(c)<br>    print(c.name..” 被 “..self.name..”访问”)<br>end  </p>
<p>function ConcreteVisitor2:VisitConcreteElementB(c)<br>    print(c.name..” 被 “..self.name..”访问”)<br>end  </p>
<p>Element = {}  </p>
<p>function Element:new(n,o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    self.name = n<br>    return o;<br>end  </p>
<p>ConcreteElementA = Element:new()  </p>
<p>function ConcreteElementA:Accept(v)<br>    v:VisitConcreteElementA(self)<br>end  </p>
<p>ConcreteElementB = Element:new()  </p>
<p>function ConcreteElementB:Accept(v)<br>    v:VisitConcreteElementB(self)<br>end  </p>
<p>ObjectStructure = {}  </p>
<p>function ObjectStructure:new(o)<br>    o = o or {}<br>    setmetatable(o,self)<br>    self.__index = self<br>    o.elements = {}<br>    return o<br>end   </p>
<p>function ObjectStructure:Attach(e)<br>    table.insert(self.elements,e)<br>end  </p>
<p>function ObjectStructure:Detach(e)<br>    for k, v in pairs(self.elements) do<br>        if v == theconcreteobserver then<br>            table.remove(self.elements,k)<br>            break<br>        end<br>    end<br>end  </p>
<p>function ObjectStructure:Accept(v)<br>    for _,e in ipairs(self.elements) do<br>        e:Accept(v)<br>    end<br>end  </p>
<p>obj = ObjectStructure:new()<br>obj:Attach(ConcreteElementA:new(“XX博物馆”))<br>obj:Attach(ConcreteElementB:new(“XX动物园”))  </p>
<p>xiaoming = ConcreteVisitor1:new(“小明”)<br>xiaohong = ConcreteVisitor2:new(“小红”)  </p>
<p>obj:Accept(xiaoming)<br>obj:Accept(xiaohong)<br>```<br>输出结果：<br>XX博物馆 被 小明访问<br>XX动物园 被 小明访问<br>XX博物馆 被 小红访问<br>XX动物园 被 小红访问  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://allran.github.io/2014/01/26/2014-01-26-lua-design-patterns/" data-id="cibixpqn0000s5zezlp1wmyjc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lua/">lua</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/01/28/2014-01-28-xcode-huan-jing-bian-liang/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Xcode 环境变量
        
      </div>
    </a>
  
  
    <a href="/2014/01/15/2014-01-15-gitzi-yuan-guan-li/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Git资源管理</div>
    </a>
  
</nav>

  
</article>




</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Lua/">Lua</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Octopress/">Octopress</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/UI/">UI</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Xcode/">Xcode</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/erlang/">erlang</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI/">UI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejabberd/">ejabberd</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lua/">lua</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xcode/">xcode</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/UI/" style="font-size: 10px;">UI</a> <a href="/tags/ejabberd/" style="font-size: 10px;">ejabberd</a> <a href="/tags/git/" style="font-size: 20px;">git</a> <a href="/tags/lua/" style="font-size: 10px;">lua</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/xcode/" style="font-size: 10px;">xcode</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">一月 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/06/08/关于Markdown/">关于Markdown</a>
          </li>
        
          <li>
            <a href="/2015/06/08/基于Erlang-OTP构建一个TCP服务器/">基于Erlang OTP构建一个TCP服务器</a>
          </li>
        
          <li>
            <a href="/2015/05/26/CentOS搭建VPN/">CentOS搭建VPN</a>
          </li>
        
          <li>
            <a href="/2015/05/13/erlang-use/">erlang use</a>
          </li>
        
          <li>
            <a href="/2015/05/12/InterlliJ-Use/">InterlliJ Use</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Allran<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/About" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>